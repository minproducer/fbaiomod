import{bf as e,r as n,b3 as i,b8 as t,bn as s,bl as r}from"./index-BoH2j3cU.js";import{d as a}from"./dayjs.min-BtTaSKBf.js";import{d as o,u as l,t as d,S as c,c as m,f as u,T as p,b as h,s as g,v as x,o as j,h as v,aH as f}from"./MyApp-D93h0aQZ.js";import{u as y}from"./useForceStop-BT3l6lDG.js";import{E as k}from"./ExportButton-bON9fXxS.js";import T from"./useCacheState-CRWoF5gI.js";import{getMyManagedGroups as b,UserTypeInGroup as N,getMyJoinedGroups as L,SubspaceType as D,leaveGroup as _,getGroupMemberCount as w}from"./groups-D329Q9FY.js";import{checkVIP as E}from"./useVIP-f__zpoad.js";import C from"./WordStatisticButton-DGDRooso.js";import{u as O}from"./useAction-B53X_KY4.js";import{u as M}from"./useDevMode-BCrlvjeP.js";import{S as F}from"./Screen-BEv7M6xj.js";import G from"./MyTable-B-PXqHUM.js";import{A as I}from"./index-BMF_2O9_.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-CXkkWBEB.js";import"./index-7X6rB-D6.js";import"./SearchOutlined-BUONfEHJ.js";import"./index-IueWr_3q.js";import"./BadgeWrapper-D2jAMD-I.js";import"./index-Q-uEsnt7.js";import"./index-DZ4ORVOX.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./index-p3GZU5lJ.js";import"./index-BS-7HFpi.js";import"./index-BwkmqrWl.js";import"./col-pZhDRk6E.js";import"./row-B1CxNhq6.js";import"./useBreakpoint-CUrvcDr2.js";import"./index-CLQrWQaN.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./Pagination-CIrtJa5e.js";import"./index-DD15UiBp.js";function P(){const{message:P,notification:S}=o(),R=e(),{ti:$}=l(),{onClickAction:Y,onClickBulkActions:A}=O(),{devMode:V}=M(),B=y(),[H,W]=T("Groups.data",[]),[J,z]=T("Groups.finished",!1),[U,q]=n.useState(!1),K=n.useRef(null);n.useEffect((()=>{J||Q(!1)}),[]);const Q=async(e=!1)=>{var n;if(U&&!e)return;const i=B.start(),t=e?[]:[...H],s=new Set(t.map((e=>e.id))),r="Groups:onReload";d(r),q(!0),z(!1);try{for(const[a,o]of[[b,N.ADMIN],[L,N.MEMBER]]){const l=t[t.length-1];let d=e?"":(null==l?void 0:l.userType)===o?null==l?void 0:l.cursor:"";for(;!i.value();){P.loading({key:r,content:$({en:"Loading groups...",vi:"Đang tải nhóm..."})+t.length,duration:0});const e=await a({cursor:d}),i=null==e?void 0:e.filter((e=>!s.has(e.id)));if(e.forEach((e=>s.add(e.id))),!(null==i?void 0:i.length))break;t.push(...i),d=null==(n=null==t?void 0:t[(null==t?void 0:t.length)-1])?void 0:n.cursor,W([...t])}}P.success({key:r,content:(i.value()?$({en:"Load groups stopped ",vi:"Dừng tải nhóm "}):$({en:"Load groups completed ",vi:"Tải xong nhóm "}))+t.length}),z(!i.value())}catch(a){P.error({content:$({en:"Failed to load groups: ",vi:"Lỗi tải nhóm: "})+a.message})}finally{q(!1)}},X=(e,n=!1)=>Y({key:"Groups:onClickLeaveGroup",id:e.id,record:e,actionFn:()=>V?x(1e3):_(e.id),loadingText:e=>$({en:"Leaving group...",vi:"Đang rời nhóm..."})+e.name,successText:e=>$({en:"Left group ",vi:"Đã rời nhóm "})+e.name,failedText:e=>$({en:"Failed to leave group: ",vi:"Lỗi rời nhóm: "})+e.name,onSuccess(){((e,n=N.NOT_JOINED)=>{W((i=>r(i,(i=>{const t=i.findIndex((n=>n.id==e));return i[t].userType=n,i}))))})(e.id)},needConfirm:n,confirmProps:{title:$({en:"Leave group?",vi:"Rời nhóm?"}),text:e.name}}),Z=e=>{switch(e){case N.MEMBER:return{color:"default",text:$({en:"Member",vi:"Thành viên"})};case N.ADMIN:return{color:"success",text:"Admin"};case N.NOT_JOINED:return{color:"error",text:$({en:"Left group",vi:"Đã rời nhóm"})};case N.PENDING:return{color:"warning",text:$({en:"Pending",vi:"Đang chờ"})};default:return{color:"default",text:"?"}}},ee=[{title:"#",key:"index",dataIndex:"index"},{title:$({en:"Group",vi:"Nhóm"}),key:"group",dataIndex:"group",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n,t)=>i.jsxs(c,{style:{maxWidth:400},align:"start",children:[i.jsx(I,{src:n.avatar,size:45}),i.jsxs(c,{direction:"vertical",size:0,children:[i.jsx(m.Link,{href:n.url,target:"_blank",children:i.jsx("b",{children:n.name})}),i.jsx(m.Text,{type:"secondary",children:n.id})]})]})},{title:$({en:"Last visit",vi:"Lần xem gần nhất"}),key:"lastVisitedTime",dataIndex:"lastVisitedTime",sorter:(e,n)=>e.lastVisitedTime-n.lastVisitedTime,render:(e,n,i)=>u(n.lastVisitedTime),align:"right"},{title:$({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,n,t)=>{const{color:s,text:r}=Z(n.userType);return i.jsxs(i.Fragment,{children:[n.subspaceType==D.TOP_LEVEL_GROUP&&i.jsxs(i.Fragment,{children:[i.jsx(p,{title:$({en:"Your most interested group",vi:"Nhóm bạn quan tâm nhất"}),children:i.jsx(h,{color:"purple",children:"Top level"})}),i.jsx("br",{})]}),i.jsx(h,{color:s,children:r})]})},filters:[...Object.values(N).map((e=>{const{text:n}=Z(e);return{text:n+" ("+H.filter((n=>n.userType==e)).length+")",value:e}})),{text:"Top level ("+H.filter((e=>e.subspaceType==D.TOP_LEVEL_GROUP)).length+")",value:D.TOP_LEVEL_GROUP}],onFilter:(e,n)=>e==D.TOP_LEVEL_GROUP?n.subspaceType==e:n.userType==e,align:"right"},{title:$({en:"Action",vi:"Hành động"}),key:"action",render:(e,n,r)=>i.jsxs(c.Compact,{style:{minWidth:30},children:[i.jsx(p,{title:$({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:i.jsx(t,{type:"default",onClick:()=>(e=>{R("/bulk-downloader",{state:{targetId:e.id,platform:s.Facebook}})})(n),icon:i.jsx("i",{className:"fa-solid fa-download"})})}),n.userType!==N.NOT_JOINED?i.jsx(p,{title:$({en:"Leave group",vi:"Rời nhóm"}),children:i.jsx(t,{danger:!0,onClick:()=>X(n,!0),icon:i.jsx("i",{className:"fa-regular fa-trash-can"})})}):null]}),align:"right"}];return i.jsx(F,{title:$({en:"Groups manager",vi:"Quản lý nhóm"}),titleSuffix:i.jsx(h,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:H.length}),children:i.jsx(G,{ref:K,data:[...H].sort(((e,n)=>n.subspaceType.localeCompare(e.subspaceType))).map(((e,n)=>({...e,index:n+1}))),columns:ee,renderTitle:e=>{var n,s;const r=(null==e?void 0:e.length)?[...e]:[...H],o=(null==(n=null==r?void 0:r.map((e=>H.find((n=>n.id===e.id)))))?void 0:n.filter((e=>e&&e.userType!==N.NOT_JOINED)))||[],l=(null==(s=null==r?void 0:r.map((e=>H.find((n=>n.id===e.id)))))?void 0:s.filter((e=>e&&e.userType!==N.ADMIN&&e.userType!==N.PENDING)))||[];return i.jsxs(i.Fragment,{children:[i.jsx(t,{type:"primary",icon:U?i.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):i.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>Q(!0),children:$({en:"Reload",vi:"Tải lại"})}),i.jsx(k,{data:r,options:[{key:"id",label:".txt (group id)",prepareData:e=>({fileName:"your_groups_id"+a().format("YYYY-MM-DD-HHmmss")+".txt",data:null==e?void 0:e.map((e=>e.id)).join("\n")})},{key:"id_name",label:".csv (id+name)",prepareData:e=>({fileName:"my_joined_groups_id_name.csv",data:j(e.map((e=>({uid:e.id,name:e.name}))))})},{key:"json",label:".json",prepareData:e=>({fileName:"your_groups"+a().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(null==e?void 0:e.map((e=>({...e,last_visited:u(e.lastVisitedTime)}))),null,4)})},{key:"csv",label:".csv",prepareData:e=>({fileName:"your_groups"+a().format("YYYY-MM-DD-HHmmss")+".csv",data:j(e)})}]}),i.jsx(p,{title:$({en:`Leave ${o.length} selected groups`,vi:`Rời ${o.length} nhóm được chọn`}),children:i.jsx(t,{danger:!0,disabled:o.length<=0,icon:i.jsx("i",{className:"fa-regular fa-trash-can"}),onClick:()=>{return A({data:e=o,key:"Groups:onClickLeaveSelectedGroups",actionFn:X,loadingText:(e,n,i)=>$({en:"Leaving groups...",vi:"Đang rời nhóm..."}),successText:(e,n)=>$({en:"Bulk leave groups completed",vi:"Hoàn tất Rời nhóm hàng loạt"}),successDescItem:e=>i.jsx("a",{target:"_blank",href:v(e.id),children:e.name}),confirmProps:{title:$({en:`Leave ${e.length} groups`,vi:`Rời ${e.length} nhóm`}),text:$({en:`Are your sure want to Leave ${e.length} groups?`,vi:`Bản có chãc muốn rời ${e.length} nhóm?`})}});var e},children:o.length})}),i.jsx(p,{title:$({en:`Find groups that have no admin in ${l.length} selected groups`,vi:`Tìm nhóm không có admin quản lý trong ${l.length} nhóm được chọn`}),children:i.jsx(t,{icon:i.jsx("i",{className:"fa-solid fa-user-large-slash"}),onClick:()=>(async e=>{var n,t;if(!(await E()))return;const s="Groups:onClickFindNoAdminGroups",r=s+":waiting";d(s),P.loading({key:s,duration:0,content:$({en:"Finding groups no admin... ",vi:"Đang tìm nhóm không có admin... "})});let a=[],o=!1;for(let l=0;l<e.length&&!o;l++){const d=e[l],c={key:s,duration:0,content:i.jsxs(i.Fragment,{children:[$({en:"Checking group... ",vi:"Đang kiểm tra... "})+`${l+1}/${e.length}`,i.jsx("br",{}),d.name,i.jsx("br",{}),$({en:"Found ",vi:"Tìm thấy "})+a.length,i.jsx("br",{}),i.jsx("i",{children:$({en:"Click to stop",vi:"Bấm để dừng"})})]}),onClick:()=>{o=!0}};if(P.loading(c),0===(await w(d.id)).adminCount&&(a.push(d),null==(t=null==(n=K.current)?void 0:n.setDataSelected)||t.call(n,[...a])),P.success(c),l<e.length-1){const e=f(2e3,5e3);await x(e,(e=>(P.loading({key:r,content:$({en:"Waiting "+Math.round(e/1e3)+"s",vi:"Đang đợi "+Math.round(e/1e3)+"s"}),duration:0}),o)))}}P.destroy(s),P.destroy(r),S.open({type:"success",duration:0,message:$({en:`Found ${a.length}/${e.length} groups no admin`,vi:`Tìm thấy ${a.length}/${e.length} nhóm không có admin`}),description:i.jsx("ol",{style:{maxHeight:300,overflowY:"auto",whiteSpace:"pre-wrap"},children:a.map((e=>i.jsx("li",{children:i.jsx("a",{target:"_blank",href:v(e.id),children:e.name})},e.id)))})})})(l),disabled:l.length<=0,children:l.length})}),i.jsx(C,{name:"Groups",text:H.map((e=>e.name)).join(" ")}),i.jsx(p,{title:$({en:"View on Facebook",vi:"Xem trên Facebook"}),children:i.jsx(t,{icon:i.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/groups/joins","_blank")})})]})},size:"small",searchable:!0,selectable:!0,onSearchRow:(e,n)=>g(e,(null==n?void 0:n.name)+(null==n?void 0:n.id)+u(null==n?void 0:n.lastVisitedTime)),keyExtractor:e=>e.id})})}export{P as default};
