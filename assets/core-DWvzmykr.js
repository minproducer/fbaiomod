import{aP as i}from"./index-BoH2j3cU.js";import{X as o,x as n}from"./MyApp-D93h0aQZ.js";const e={msToken:null,profile:null,appContext:null,bizContext:null};async function l(o){var e;const l=null==(e=(await i(o)).match(/__UNIVERSAL_DATA_FOR_REHYDRATION__\" type=\"application\/json\">(.*?)<\/script>/))?void 0:e[1];return n(l)}async function t(i){var n;i.startsWith("@")&&(i=`https://www.tiktok.com/${i}`),i.includes("https://www.tiktok.com/@")||(i=`https://www.tiktok.com/@${i}`);try{const t=await l(i),a=o(t,["__DEFAULT_SCOPE__","webapp.user-detail","userInfo"]),u=o(t,["__DEFAULT_SCOPE__","webapp.app-context"]),d=o(t,["__DEFAULT_SCOPE__","webapp.biz-context"]);console.log(a,u,d),u&&(e.appContext=u),d&&(e.bizContext=d);const{user:r,stats:v}=a;return{id:r.id,nickname:r.nickname,secUid:r.secUid,uniqueId:r.uniqueId,shortId:r.shortId,avatar:r.avatarLarger||r.avatarMedium||r.avatarThumb,createTime:1e3*(r.createTime||0),verified:r.verified,language:r.language,region:r.region,signature:r.signature,bioLink:null==(n=r.bioLink)?void 0:n.link,modifyTime:{nickname:1e3*(r.nickNameModifyTime||0),uniqueId:1e3*(r.uniqueIdModifyTime||0)},stats:{followerCount:v.followerCount,followingCount:v.followingCount,friendCount:v.friendCount,videoCount:v.videoCount,heartCount:v.heartCount}}}catch(t){console.log(t);const o=await v();return(null==o?void 0:o.uniqueId)&&i.includes(o.uniqueId)?o:(console.log("not me",o),null)}}async function a(i){const n=await l(i);return u(o(n,["__DEFAULT_SCOPE__","webapp.video-detail","video"]))}function u(i){var o,n,e;const l=null==(n=(null==(o=null==i?void 0:i.bitrateInfo)?void 0:o.map((o=>{var n,e,l;const t=null==(n=null==o?void 0:o.PlayAddr)?void 0:n.UrlList;return{id:null==o?void 0:o.GearName,codecs:null==o?void 0:o.CodecType,mimeType:"video/mp4",isAudio:!1,height:null==(e=null==o?void 0:o.PlayAddr)?void 0:e.Height,width:null==(l=null==o?void 0:o.PlayAddr)?void 0:l.Width,bandwidth:null==o?void 0:o.Bitrate,qualityClass:null==o?void 0:o.QualityType,qualityLabel:null==o?void 0:o.GearName,source:null==t?void 0:t[(null==t?void 0:t.length)-1],length:(null==i?void 0:i.duration)||0,urls:t}})))||[])?void 0:n.sort(((i,o)=>o.width*o.height-i.width*i.height));return{id:null==i?void 0:i.id,cover:null==i?void 0:i.cover,dynamicCover:null==i?void 0:i.dynamicCover,zoomCover:null==i?void 0:i.zoomCover,originCover:null==i?void 0:i.originCover,width:null==i?void 0:i.width,height:null==i?void 0:i.height,duration:null==i?void 0:i.duration,ratio:null==i?void 0:i.ratio,definition:null==i?void 0:i.definition,codecType:null==i?void 0:i.codecType,format:null==i?void 0:i.format,videoQuality:null==i?void 0:i.videoQuality,downloadAddr:null==i?void 0:i.downloadAddr,source:(null==(e=null==l?void 0:l[0])?void 0:e.source)||(null==i?void 0:i.playAddr)||(null==i?void 0:i.downloadAddr),variants:l,raw:i}}function d(i){var o,n,e,l;return i?{cover:null==(e=null==(n=null==(o=null==i?void 0:i.cover)?void 0:o.imageURL)?void 0:n.urlList)?void 0:e[0],images:null==(l=null==i?void 0:i.images)?void 0:l.map((i=>{var o,n;return null==(n=null==(o=null==i?void 0:i.imageURL)?void 0:o.urlList)?void 0:n[0]}))}:null}function r(i={}){var o,n,l,t,a,u,d,r,v,s,c,m,p,g;return{WebIdLastTime:Math.round((new Date).getTime()/1e3),aid:1988,app_language:(null==(o=e.appContext)?void 0:o.$language)||(null==(n=e.appContext)?void 0:n.language),app_name:"tiktok_web",browser_language:navigator.language,browser_name:navigator.userAgent.match(/\w+/)[0],browser_online:navigator.onLine,browser_platform:navigator.platform,browser_version:null==(l=e.appContext)?void 0:l.userAgent,channel:"tiktok_web",cookie_enabled:navigator.cookieEnabled,count:35,coverFormat:2,cursor:0,device_id:(null==(t=e.appContext)?void 0:t.$wid)||(null==(a=e.appContext)?void 0:a.wid),device_platform:"web_pc",focus_state:!0,from_page:"user",history_len:window.history.length,is_fullscreen:window.matchMedia("(display-mode: fullscreen)").matches,is_page_visible:!0,language:(null==(u=e.appContext)?void 0:u.$language)||(null==(d=e.appContext)?void 0:d.language),odinId:null==(r=e.appContext)?void 0:r.odinId,os:(null==(v=e.bizContext)?void 0:v.$os)||(null==(s=e.bizContext)?void 0:s.os),priority_region:"",region:(null==(c=e.appContext)?void 0:c.$region)||(null==(m=e.appContext)?void 0:m.region),screen_height:screen.height,screen_width:screen.width,tz_name:Intl.DateTimeFormat().resolvedOptions().timeZone,webcast_language:(null==(p=e.appContext)?void 0:p.$language)||(null==(g=e.appContext)?void 0:g.language),...i}}async function v(){const o=r({}),e="https://www.tiktok.com/passport/web/account/info/?"+Object.entries(o).map((i=>i.join("="))).join("&"),l=await i(e,{credentials:"include"}),t=n(l);console.log(l,t);const a=(null==t?void 0:t.data)||{};return{id:a.user_id_str,nickname:a.screen_name,avatar:a.avatar_url,createTime:1e3*(a.create_time||0),secUid:a.sec_user_id,shortId:a.username,uniqueId:a.username}}function s(i){return(null==i?void 0:i.map((o=>{var n,e,l,t,a,r,v,s,c,m,p,g,h,_,w,C,f,y,b,T,k,x,I;return{id:o.id,desc:o.desc,createTime:1e3*(o.createTime||0),image:d(o.imagePost),video:u(o.video),challenges:null==(n=o.challenges)?void 0:n.map((i=>({id:i.id,title:i.title}))),stats:{collectCount:null==(e=o.stats)?void 0:e.collectCount,commentCount:null==(l=o.stats)?void 0:l.commentCount,diggCount:null==(t=o.stats)?void 0:t.diggCount,playCount:null==(a=o.stats)?void 0:a.playCount,shareCount:null==(r=o.stats)?void 0:r.shareCount},author:{id:null==(v=o.author)?void 0:v.id,nickname:null==(s=o.author)?void 0:s.nickname,secUid:null==(c=o.author)?void 0:c.secUid,signature:null==(m=o.author)?void 0:m.signature,uniqueId:null==(p=o.author)?void 0:p.uniqueId,verified:null==(g=o.author)?void 0:g.verified,avatar:(null==(h=o.author)?void 0:h.avatarLarger)||(null==(_=o.author)?void 0:_.avatarMedium)||(null==(w=o.author)?void 0:w.avatarThumb)},music:{id:null==(C=o.music)?void 0:C.id,author:null==(f=o.music)?void 0:f.author,title:null==(y=o.music)?void 0:y.title,playUrl:null==(b=o.music)?void 0:b.playUrl,original:null==(T=o.music)?void 0:T.original,cover:(null==(k=o.music)?void 0:k.coverLarger)||(null==(x=o.music)?void 0:x.coverMedium)||(null==(I=o.music)?void 0:I.coverThumb)},cursor:null==i?void 0:i.cursor,raw:o}})))||[]}export{s as extractItemList,r as genParams,v as getMyTiktokProfile,t as getTiktokUserInfo,a as getTiktokVideoFromURL};
