import{aP as o}from"./index-BoH2j3cU.js";import{x as i}from"./MyApp-D93h0aQZ.js";import{waitWinForReady as n,runFnInWin as t}from"./window-Dhlqh9T1.js";async function l(o){var i,l,e,a,d,r;let s;try{const u=null==(i=o.match(/\/file\/d\/([^/]+)/))?void 0:i[1];if(!u)throw new Error("Video ID not found");s=window.open(o,"_blank","width=800,height=600"),await n(s),await new Promise((o=>setTimeout(o,1e3)));const c=new URL(o).origin,v=await t({win:s,fnPath:"window.gapi.client.request",params:[`https://workspacevideo-pa.clients6.google.com/v1/drive/media/${u}/playback`],origin:c}),w=null==v?void 0:v.result,h=null==(l=null==w?void 0:w.mediaStreamingData)?void 0:l.formatStreamingData,f=[...(null==h?void 0:h.adaptiveTranscodes)||[],...(null==h?void 0:h.progressiveTranscodes)||[]].map((o=>{var i,n,t,l,e,a,d,r,s,u;return{codecs:(null==(i=null==o?void 0:o.transcodeMetadata)?void 0:i.videoCodecString)||(null==(n=null==o?void 0:o.transcodeMetadata)?void 0:n.audioCodecString),bandwidth:parseInt(null==(t=null==o?void 0:o.transcodeMetadata)?void 0:t.contentLength),length:parseInt(null==(l=null==o?void 0:o.transcodeMetadata)?void 0:l.approxDuration),mimeType:null==(e=null==o?void 0:o.transcodeMetadata)?void 0:e.mimeType,width:null==(a=null==o?void 0:o.transcodeMetadata)?void 0:a.width,height:null==(d=null==o?void 0:o.transcodeMetadata)?void 0:d.height,id:null==o?void 0:o.itag,isAudio:null==(u=null==(s=null==(r=null==o?void 0:o.transcodeMetadata)?void 0:r.mimeType)?void 0:s.includes)?void 0:u.call(s,"audio"),qualityLabel:"",qualityClass:"",source:null==o?void 0:o.url}})).sort(((o,i)=>i.bandwidth-o.bandwidth)),p={source:null==(e=f.at(-1))?void 0:e.source,thumbnail:null==(r=null==(d=null==(a=null==w?void 0:w.thumbnails)?void 0:a.sort(((o,i)=>i.width-o.width)))?void 0:d[0])?void 0:r.url,variants:f};return console.log(p),p}catch(u){throw u}finally{"function"==typeof(null==s?void 0:s.close)&&s.close()}}async function e(l){var e;let a;try{if(!(null==(e=l.match(/\/file\/d\/([^/]+)/))?void 0:e[1]))throw new Error("File ID not found");a=window.open(l,"_blank","width=800,height=600"),await n(a);const d=await t({win:a,fnPath:"window.viewerData",params:[]});if(!d)throw new Error("File not found");const{config:r,itemJson:s,configJson:u}=d||{},{id:c,title:v}=r||{};let w=null==s?void 0:s.find((o=>{var i;return null==(i=null==o?void 0:o.includes)?void 0:i.call(o,"meta?ck=")}));if(!w){const n=null==s?void 0:s.find((o=>{var i;return null==(i=null==o?void 0:o.includes)?void 0:i.call(o,"ds=")}));if(!n)throw new Error("File meta & ds not found");for(const t of[!1,!0]){const l=t?"&authuser=1":"",e=await o(n+l);if(!e)continue;const a=e.split("\n"),d=i(a[1]||a[0]||"{}");console.log(d);const{img:r,meta:s,page:u,press:c,presspage:v,status:h}=d;if(s){w="https://drive.google.com/viewerng/"+s;break}}}if(console.log(d,c,v,w),!w)throw new Error("File meta info not found");for(const n of[!1,!0]){const t=n?"&authuser=1":"",l=(await o(w+t)).split("\n"),e=i(l[1]||l[0]||"{}");console.log(e);const{pages:a,maxPageWidth:d}=e;if(!a||!d)continue;const r=[];for(let o=0;o<a;o++){const i=w.replace("/meta?","/img?")+`&page=${o}&skiphighlight=true&skipwidget=false&w=${d}&webp=true`+t;r.push(i)}return console.log(r,n),{maxPageWidth:d,pages:r,title:v,id:c,isNeedAuth:n}}throw new Error("File info not found")}catch(d){throw d}finally{"function"==typeof(null==a?void 0:a.close)&&a.close()}}export{e as getGoogleDrivePDFFromURL,l as getGoogleDriveVideoFromURL};
