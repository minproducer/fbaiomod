import{r as e,b3 as i,b8 as n,bl as t}from"./index-BoH2j3cU.js";import{F as o,g as l,a as s,b as a,f as r,u as d,c}from"./follows-q4xuCI_8.js";import{u as h,d as m,v as f,W as u,s as g,S as p,I as x,i as j,b as w,T as v,o as y,h as F,t as k}from"./MyApp-D93h0aQZ.js";import b from"./MyTable-B-PXqHUM.js";import{E as L}from"./ExportButton-bON9fXxS.js";import{u as T}from"./useAction-B53X_KY4.js";import N from"./useCacheState-CRWoF5gI.js";import O from"./WordStatisticButton-DGDRooso.js";import{B as C}from"./BadgeWrapper-D2jAMD-I.js";import{u as B}from"./useDevMode-BCrlvjeP.js";import{S}from"./Screen-BEv7M6xj.js";import{getAllFriends as D}from"./friends-CuTZrwTt.js";import{A as U}from"./index-BMF_2O9_.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-7X6rB-D6.js";import"./row-B1CxNhq6.js";import"./useVIP-f__zpoad.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-CXkkWBEB.js";import"./index-IueWr_3q.js";import"./index-BwkmqrWl.js";import"./index-Q-uEsnt7.js";import"./index-DZ4ORVOX.js";import"./col-pZhDRk6E.js";import"./gender-D7cqwEK5.js";import"./index-DD15UiBp.js";function I(){const{ti:I}=h(),{message:W,notification:E}=m(),{onClickAction:_,onClickBulkActions:A}=T(),{devMode:P}=B(),[M,G]=N("Follows.friends",[]),[R,q]=N("Follows.data",[]),[z,V]=e.useState(!1),[X,H]=N("Follows.loadingFollowBulk",!1),[J,K]=N("Follows.loadingUnFollowBulk",!1),[Q,Z]=N("Follows.loadingRecord",{}),[$,Y]=N("Follows.loadingUnfollowed",!1),[ee,ie]=e.useMemo((()=>[R.filter((e=>e.status===o.FOLLOWING)),R.filter((e=>e.status===o.UNFOLLOWED))]),[R]),ne=e.useRef(null);e.useEffect((()=>{oe()}),[]);const te=e.useRef(!1),oe=async(e=!1)=>{if(te.current||z)return;te.current=!0;const i="Follows:onReload";W.loading({key:i,content:I({en:"Loading following...",vi:"Đang tải người bạn theo dõi..."}),duration:0}),V(!0);const n=e?[]:R,t=new Set(n.map((e=>e.id)));for(const[s,a]of[[l,I({en:"Loading following (option 2)... ",vi:"Đang tải người theo dõi (cách 2)... "})]]){let e="";for(;;){W.loading({key:i,content:a+n.length,duration:0});const o=await s(e);if(!(null==o?void 0:o.length))break;let l=!1;for(let e of o)t.has(e.id)||(n.push(e),t.add(e.id),l=!0);if(!l)break;q([...n.map(((e,i)=>({...e,i:i+1})))]),e=o[o.length-1].cursor,await f(300)}}W.loading({key:i,content:I({en:"Loading friends...",vi:"Đang tải danh sách bạn bè..."}),duration:0});const o=await D({myUid:await u()});G(o),W.success({key:i,content:I({en:"Finish loading follows: ",vi:"Tải xong danh sách theo dõi: "})+n.length}),V(!1),te.current=!1},le=(e,i)=>{var n,o,l,s;q((n=>t(n,(n=>{const t=n.find((i=>i.id===e.id));return t&&(t.status=i),n}))));const a=null==(o=null==(n=ne.current)?void 0:n.getDataSelected)?void 0:o.call(n);a&&(null==(s=null==(l=ne.current)?void 0:l.setDataSelected)||s.call(l,a.filter((i=>i.id!==e.id))))},se=(e,i=!1)=>(Z((i=>({...i,[e.id]:!0}))),_({record:e,id:e.id,key:"Follows:onClickFollow",actionFn:()=>P?f(1e3):r(e),loadingText:()=>I({en:"Following...",vi:"Đang theo dõi..."})+" "+e.name,successText:()=>I({en:"Followed",vi:"Đã theo dõi"})+" "+e.name,failedText:()=>I({en:"Failed to follow",vi:"Lỗi theo dõi"})+" "+e.name,onSuccess:()=>{le(e,o.FOLLOWING)},needConfirm:i,confirmProps:{title:I({en:"Follow?",vi:"Theo dõi?"}),text:e.name}}).finally((()=>{Z((i=>({...i,[e.id]:!1})))}))),ae=(e,i=!0)=>(Z((i=>({...i,[e.id]:!0}))),_({record:e,id:e.id,key:"Follows:onClickUnFollow",actionFn:()=>P?f(1e3):d(e),loadingText:()=>I({en:"Unfollowing...",vi:"Đang bỏ theo dõi..."})+" "+e.name,successText:()=>I({en:"Unfollowed",vi:"Đã bỏ theo dõi"})+" "+e.name,failedText:()=>I({en:"Failed to unfollow",vi:"Lỗi bỏ theo dõi"})+" "+e.name,onSuccess:()=>{le(e,o.UNFOLLOWED)},needConfirm:i,confirmProps:{title:I({en:"Unfollow?",vi:"Bỏ theo dõi?"}),text:e.name}}).finally((()=>{Z((i=>({...i,[e.id]:!1})))}))),re=async()=>{const e="Follows:onClickLoadUnfollowed";k(e),W.loading({key:e,content:I({en:"Loading unfollowed...",vi:"Đang tải lịch sử bỏ theo dõi..."}),duration:0});const n=[];let o="",l=!1;for(;!l;){const s=await c(o);if(console.log(s),!s.length)break;n.push(...s),o=s[s.length-1].cursor,W.loading({key:e,content:i.jsxs(i.Fragment,{children:[I({en:"Loading unfollowed...",vi:"Đang tải lịch sử bỏ theo dõi..."})+" "+n.length,i.jsx("br",{}),I({en:"Click to stop",vi:"Bấm để dừng"})]}),duration:0,onClick:()=>l=!0}),q((e=>t(e,(e=>{for(let i of s){const n=e.findIndex((e=>e.id===i.id));-1!==n?e[n]=i:e.unshift(i)}return e})))),await f(1e3)}W.destroy(e),E.open({type:"success",message:I({en:"Load unfollowed success",vi:"Tải xong lịch sử bỏ theo dõi"}),description:I({en:"Found "+n.length+" users you have unfollowed",vi:"Tìm thấy "+n.length+" người bạn từng bỏ theo dõi"}),duration:0})},de=e.useMemo((()=>{const e=new Set(M.map((e=>e.uid)));return R.filter((i=>e.has(i.id))).length}),[M,R]),ce=[{title:"#",dataIndex:"i",width:50,sorter:(e,i)=>e.i-i.i},{title:I({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(e,i)=>(e.name||"").localeCompare(i.name||""),render:(e,n,t)=>i.jsxs(p,{align:"center",style:{maxWidth:400},children:[i.jsx(U,{shape:"square",src:i.jsx(x,{src:j(n.id),fallback:n.avatar}),size:50}),i.jsxs(p,{direction:"vertical",style:{marginLeft:"10px"},size:0,children:[i.jsx("a",{href:n.url,target:"_blank",children:i.jsx("b",{children:n.name})}),i.jsx("span",{style:{opacity:.5},children:n.id})]})]}),onSearch:(e,i,n)=>g(e,n.name+n.id),width:"auto"},{title:I({en:"Desc",vi:"Mô tả"}),key:"desc",dataIndex:"desc",render:(e,n,t)=>i.jsx("p",{style:{maxWidth:300,minWidth:50},children:e}),sorter:(e,i)=>(e.desc||"").localeCompare(i.desc||"")},{title:I({en:"Type",vi:"Loại"}),key:"type",dataIndex:"type",filters:Object.entries(s).map((([e,i])=>({text:i+" ("+R.filter((e=>e.type===i)).length+")",value:i}))),onFilter:(e,i)=>i.type===e,width:120},{title:de+" "+I({en:"Friend",vi:"Bạn bè"}),key:"friend",dataIndex:"friend",render:(e,n,t)=>new Set(M.map((e=>e.uid))).has(n.id)?i.jsx(w,{color:"success",children:I({en:"Friend",vi:"Bạn bè"})}):"-",filters:[{text:I({en:"Friend: ",vi:"Bạn bè: "})+de,value:!0},{text:I({en:"No: ",vi:"Không: "})+(R.length-de),value:!1}],onFilter:(e,i)=>new Set(M.map((e=>e.uid))).has(i.id)===e,width:120},{title:I({en:"Status",vi:"Trạng thái"}),key:"status",dataIndex:"status",render:(e,n,t)=>{const l=I(a[n.status]);return n.status===o.UNFOLLOWED?i.jsx(w,{color:"error",children:l}):l},filters:Object.entries(a).map((([e,i])=>({text:I(i)+" ("+R.filter((i=>i.status===e)).length+")",value:e}))),onFilter:(e,i)=>i.status===e,width:150},{title:I({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(e,t,l)=>t.status===o.FOLLOWING?i.jsx(v,{title:I({en:"UnFollow",vi:"Bỏ theo dõi"}),mouseEnterDelay:.5,children:i.jsx(n,{danger:!0,type:"default",icon:i.jsx("i",{className:"fa-solid fa-trash"}),onClick:()=>ae(t),loading:Q[t.id]})}):i.jsx(v,{title:I({en:"Follow",vi:"Theo dõi"}),mouseEnterDelay:.5,children:i.jsx(n,{type:"text",onClick:()=>se(t,!0),icon:i.jsx("i",{className:"fa-regular fa-square-plus fa-xl"}),loading:Q[t.id]})}),align:"right",width:100}];return i.jsx(S,{title:I({en:"Follows",vi:"Theo dõi"}),titleSuffix:i.jsx(w,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:R.filter((e=>e.status===o.FOLLOWING)).length}),children:i.jsx(b,{ref:ne,data:R,columns:ce,renderTitle:e=>{const t=e.length?e.filter((e=>e.status===o.FOLLOWING)):ee,l=e.length?e.filter((e=>e.status===o.UNFOLLOWED)):ie;return i.jsxs(i.Fragment,{children:[i.jsx(n,{type:"primary",icon:z?i.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):i.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>oe(!0),children:I({en:"Reload",vi:"Tải lại"})}),i.jsx(L,{data:e.length?e:ee,options:[{key:"uid",label:".txt (uid)",prepareData:e=>({fileName:"followings_uid.txt",data:e.map((e=>e.id)).join("\n")})},{key:"uid_name",label:".csv (uid+name)",prepareData:e=>({fileName:"followings_uid_name.csv",data:y(e.map((e=>({uid:e.id,name:e.name}))))})},{key:"json",label:".json",prepareData:e=>({fileName:"followings.json",data:JSON.stringify(e,null,2)})},{key:"csv",label:".csv",prepareData:e=>({fileName:"followings.csv",data:y(e)})}]}),t.length>0&&i.jsx(v,{title:I({en:"Unfollow "+t.length+" selected",vi:"Bỏ theo dõi "+t.length+" người đang chọn"}),children:i.jsx(n,{type:"default",danger:!0,icon:i.jsx("i",{className:"fa-solid fa-trash"}),disabled:0===t.length,loading:J,onClick:()=>{return e=t,K(!0),A({data:e,key:"Follows:onClickUnFollowBulk",actionFn:e=>ae(e,!1),loadingText:e=>I({en:"Unfollowing...",vi:"Đang bỏ theo dõi..."}),successText:(e,i)=>I({en:"Unfollow finished",vi:"Đã bỏ theo dõi xong"}),successDescItem:e=>i.jsx("a",{target:"_blank",href:F(e.id),children:e.name}),confirmProps:{title:I({en:"Unfollow "+e.length+" selected?",vi:"Bỏ theo dõi "+e.length+" người?"})}}).finally((()=>{K(!1)}));var e},children:t.length})}),l.length>0&&i.jsx(v,{title:I({en:"Follow "+l.length+" selected",vi:"Theo dõi "+l.length+" người đang chọn"}),children:i.jsx(n,{type:"default",icon:i.jsx("i",{className:"fa-solid fa-plus"}),disabled:0===l.length,loading:X,onClick:()=>{return e=l,H(!0),A({data:e,key:"Follows:onClickFollowBulk",actionFn:se,loadingText:e=>I({en:"Following...",vi:"Đang theo dõi..."}),successText:(e,i)=>I({en:"Follow finished",vi:"Đã theo dõi xong"}),successDescItem:e=>i.jsx("a",{target:"_blank",href:F(e.id),children:e.name}),confirmProps:{title:I({en:"Follow "+e.length+" selected?",vi:"Theo dõi "+e.length+" người?"}),text:I({en:"Are you sure?",vi:"Bạn chắc chứ?"})}}).finally((()=>{H(!1)}));var e},children:l.length})}),i.jsx(C,{type:"new",children:i.jsx(v,{title:I({en:"Load all your unfollowed users",vi:"Tải danh sách người bạn đã bỏ theo dõi"}),children:i.jsx(n,{icon:i.jsx("i",{className:"fa-solid fa-clock"}),loading:$,onClick:re,children:I({en:"Unfollowed",vi:"Xem lại"})})})}),i.jsx(O,{name:"Follows",text:R.map((e=>e.name)).join(" ")}),i.jsx(v,{title:I({en:"View on Facebook",vi:"Xem trên Facebook"}),children:i.jsx(n,{type:"default",icon:i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"}),onClick:()=>window.open("https://www.facebook.com/me/following","_blank")})})]})},size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e.id})})}export{I as default};
