const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./useVIP-f__zpoad.js","./index-BoH2j3cU.js","./index-DY-hiTTZ.css","./MyApp-D93h0aQZ.js","./sweetalert2.esm.all-BZxvatOx.js","./getIds-CXkkWBEB.js","./index-7X6rB-D6.js","./SearchOutlined-BUONfEHJ.js","./index-IueWr_3q.js","./Dropdown-C4ZC00F-.js","./file-download-DzcmM7_q.js"])))=>i.map(i=>d[i]);
import{r as e,b3 as n,b8 as t,aQ as i,cf as o,cg as l,ch as a}from"./index-BoH2j3cU.js";import{a as s,b as r}from"./index-CLQrWQaN.js";import{u as d,d as c,t as h,aL as u,S as m,c as f,b as g,T as x,ai as p,aM as j,aN as v}from"./MyApp-D93h0aQZ.js";import w,{getCacheByKey as y}from"./useCacheState-CRWoF5gI.js";import{u as b}from"./react-hotkeys-hook.esm-V0Xz-7zA.js";import{P as k}from"./index-DD15UiBp.js";import{a as C}from"./index-p3GZU5lJ.js";import{D}from"./index-DWB43XHw.js";import{I as T}from"./index-7X6rB-D6.js";import{L as $}from"./index-BJjUIN-g.js";import{R as I}from"./row-B1CxNhq6.js";import{D as S}from"./index-BwkmqrWl.js";import"./index-BS-7HFpi.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./index-CTitp5Qg.js";import"./List-BGWr2xJE.js";import"./index-UsPtaxTh.js";import"./DownOutlined-DRGhK8zp.js";import"./Pagination-CIrtJa5e.js";import"./col-pZhDRk6E.js";var _=(e=>(e.File="file",e.Link="link",e.JSON="json",e))(_||{}),P=(e=>(e.Grid="grid",e.Vertical="vertical",e))(P||{});function N({collectionName:P,renderItem:N,fetchNext:B,rowKey:E,downloadItem:L,getItemCursor:F,initialData:A=[],downloadThreads:O=5,downloadOptions:M=[],displayType:V="grid",headerButtons:R=()=>null,header:W=()=>null,once:q=!1,all:z=!1,stop:H=!1,showPagination:K=!1,hideLoadMore:G=!1,pageSize:J=20,searchPlaceholder:X=()=>({en:"Search",vi:"Tìm kiếm"}),onSearch:Q,centerItems:Z=!0}){const{ti:U}=d(),{message:Y,notification:ee}=c(),{isIntersecting:ne,ref:te}=s(),[ie,oe]=e.useState(!1),[le,ae]=w(`Collection.${P}.hasMore`,!0),[se,re]=w(`Collection.${P}.data`,A),[de,ce]=w(`Collection.${P}.pageIndex`,1),[he,ue]=w(`Collection.${P}.search`,""),[me,fe]=w(`Collection.${P}.selected`,[]),[ge,xe]=w(`Collection.${P}.selectMode`,!1),[pe,je]=w(`Collection.${P}.downloaded`,{});b(["shift"],(()=>{L&&xe((e=>!e))}));const ve=e.useMemo((()=>he&&Q?se.filter((e=>Q(he,e))):se),[se,he,Q]);e.useEffect((()=>{let e=se.length,n=Math.ceil(e/20);de>n&&ce(n)}),[se,de]),e.useEffect((()=>{se.length||ye(!1)}),[P]),e.useEffect((()=>{A&&!B&&re(A)}),[A,B]);const we=(!se.length||ne||z)&&le&&!he&&!H&&B;r((()=>{we&&ke()}),1e3),e.useEffect((()=>{we&&ke()}),[we]);const ye=(e=!1)=>{e&&h("Collection:reload");const n=e?[]:y("Collection.data."+P)||[];re(n),fe([]),ke(n)},be=e.useRef(!1),ke=async(e=se)=>{if(be.current)return;be.current=!0,oe(!0);const n=await(null==B?void 0:B(e));console.log(P,n);let t=!1;if(null==n?void 0:n.length){const i=u(e,n,E);if(ae(!q&&i.length>0),i.length){const n=[...e,...i];re(n),t=!0}}else 0===(null==n?void 0:n.length)&&ae(!1);t||e.length||Y.info(U({en:"No data found",vi:"Không có dữ liệu"})+": "+P),be.current=!1,oe(!1)},Ce=e.useCallback(((e,i)=>{const o=me.indexOf(e),l=o>=0,a=pe[E(e)],s={position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",background:l||a?"#000a":"#0002"};return n.jsxs("div",{style:{position:"relative",flexGrow:1,height:"100%"},children:[i<se.length-1?N(e,i,re):n.jsx(m,{ref:te,children:N(e,i,re)}),ge?n.jsx(t,{type:"primary",style:s,className:"scale-on-hover",onClick:()=>{fe(l?n=>n.filter((n=>n!==e)):n=>[...n,e])},children:l?n.jsx("i",{className:"fa-solid fa-5x",children:o+1}):a?n.jsx("i",{className:"fa-solid fa-check fa-5x"}):n.jsx("i",{className:"fa-solid fa-square  fa-5x",style:{color:"#fff7"}})}):a?n.jsx("div",{style:{...s,display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"none",background:"#0006"},children:n.jsx("i",{className:"fa-solid fa-check fa-5x",style:{color:"white"}})}):null]},"select_container_"+E(e))}),[se,me,pe,E,ge,N,te]),De=async({fromCursor:e,downloadType:s,startIndex:r=0}={})=>{var d;if(!L)return;const c=(await i((async()=>{const{default:e}=await import("./sweetalert2.esm.all-BZxvatOx.js");return{default:e}}),[],import.meta.url)).default;if(!("showDirectoryPicker"in window)&&"file"===s)return c.fire({icon:"error",title:U({en:"Browser not supported",vi:"Trình duyệt không hỗ trợ"}),text:U({en:"File saver API not supported in this browser. Please use newest version of Edge or Chrome. (window.showDirectoryPicker)",vi:"Trình duyệt này không hỗ trợ API lưu file (window.showDirectoryPicker). Vui lòng sử dụng Edge hoặc Chrome bản mới nhất"})});let f;if(!e&&!ge&&(f=await c.fire({icon:"question",title:U({en:"Download",vi:"Tải xuống"})+"?",text:P,showDenyButton:!0,showCancelButton:!1,confirmButtonColor:"#d33",denyButtonColor:"#1668dc",confirmButtonText:U({en:"Download from cursor",vi:"Tải từ vị trí"}),denyButtonText:U({en:"Download all",vi:"Tải từ đầu"})}),f.isDismissed))return;if(null==f?void 0:f.isConfirmed){const n=await c.fire({icon:"info",title:U({en:"Download from cursor",vi:"Tải từ vị trí"}),html:`\n                <label for="from-cursor">\n                ${U({en:"Last cursor",vi:"Con trỏ cuối"})}: (${U({en:"leave empty to re-download all",vi:"bỏ trống để tải từ đầu"})})\n                </label><br/>\n                <input\n                    id="from-cursor"\n                    class="swal2-input"\n                    style="margin: 5px"\n                    value="${e||localStorage.getItem(P+"_fromCursor")||""}">\n                <br/>\n                <label for="start-index">\n                ${U({en:"Last index",vi:"Vị trí cuối"})}: (${U({en:"for auto generate file name",vi:"để tự động tạo tên file"})})\n                </label><br/>\n                <input\n                    id="start-index"\n                    class="swal2-input"\n                    style="margin: 5px"\n                    value="${r||localStorage.getItem(P+"_startIndex")||0}">\n            `,preConfirm:()=>{var e,n;return[null==(e=document.getElementById("from-cursor"))?void 0:e.value,null==(n=document.getElementById("start-index"))?void 0:n.value]},showCancelButton:!0,confirmButtonText:U({en:"Start download",vi:"Bắt đầu tải"})});if(n.isDismissed||n.isDenied)return;e=n.value[0],r=parseInt((null==(d=n.value)?void 0:d[1])||0)}if(!s){const e=await c.fire({icon:"question",title:U({en:"Data type",vi:"Loại dữ liệu"}),html:`\n                    <label for="download-type">\n                        ${U({en:"Which data type you want to download?",vi:"Bạn muốn tải xuống loại dữ liệu nào?"})}\n                    </label><br/>\n                    <select\n                        id="download-type"\n                        class="swal2-select"\n                        style="margin: 5px">\n                        ${Object.values(_).map((e=>`<option value="${e}">${e}</option>`)).join("")}\n                    </select>\n                `,preConfirm:()=>{var e;return null==(e=document.getElementById("download-type"))?void 0:e.value},showCancelButton:!0,reverseButtons:!0});if(e.isDismissed)return;s=e.value}const g=(await i((async()=>{const{checkVIP:e}=await import("./useVIP-f__zpoad.js");return{checkVIP:e}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)).checkVIP;if(!(await g()))return;let x;if(h("downloadCollection:"+s+":"+(ge?`selected:${me.length}:`:"all:")+P),"file"===s){const e=await window.showDirectoryPicker({mode:"readwrite"});await e.requestPermission({writable:!0}),x=await e.getDirectoryHandle(j(P),{create:!0})}const p=await o(),w="downloading_collection_"+P,y="stopping_downloading_collection_"+P;Y.loading({key:w,content:U({en:"Downloading",vi:"Đang tải"})+"...",duration:0});const b=e?[]:ge?[...me]:[...se];let k=0,C=0,D=0,T=0,$=0,I=!0,N=!1,A=!1,M=!0,V=[],R=[];for(;!N&&M;){if(!ge&&$>=b.length-O){const n=await(null==B?void 0:B(b,I?e:void 0)),t=u(b,n,E);!(null==t?void 0:t.length)&&I&&e&&ee.open({type:"error",message:U({en:"No data at from your cursor",vi:"Không có dữ liệu tại vị trí bạn nhập"})+e+" ("+P+")",description:U({en:"Will download from start",vi:"Sẽ tải từ đầu"}),duration:0}),I=!1,console.log(t),(null==t?void 0:t.length)?b.push(...t):M=!1}const t=b.slice($,$+O);if(!t.length)break;const i=Math.min(O,t.length),o=Array.from({length:i},(()=>""));await Promise.all(t.map((async(e,t)=>{try{let a=await L(e,k);a||(a=[]),Array.isArray(a)||(a=[a]);let d=!1;for(let e=0;e<a.length&&!N;e++){const{url:c,name:h}=a[e];if(!c)continue;const u=r+$+t+"_"+e+"_"+h;if(a[e].name=u,o[t]="thread "+(t+1)+": item "+(k+t+1)+(a.length>1?` (${e+1}/${a.length})`:""),N||A||Y.loading({key:w,content:n.jsxs("span",{children:[`${U({en:"Downloading",vi:"Đang tải"})}... ${C}`,D?n.jsxs(n.Fragment,{children:[U({en:"Failed",vi:"Lỗi"}),": $",D," ",n.jsx("br",{})]}):"",n.jsx("br",{}),P,n.jsx("br",{}),n.jsx("i",{children:U({en:"Click to stop",vi:"Bấm để dừng"})}),n.jsx("br",{}),n.jsx(S,{}),o.map(((e,t)=>n.jsxs("span",{style:{width:"100%",textAlign:"left",display:"block"},children:[e,n.jsx("br",{})]},t))),n.jsx("br",{})]}),duration:0,onClick:()=>{N=!0,Y.loading({key:y,content:U({en:"Stopping...",vi:"Đang dừng..."}),duration:0})}}),R.push(c),"file"===s)try{const e=await v({url:c,checkAbortFn:()=>N}),n=await e.blob(),t=await x.getFileHandle(u,{create:!0}),i=await t.createWritable();await i.write(n),await i.close()}catch(i){console.log(i),N||(p?(await l({url:c,conflictAction:"overwrite",filename:P+"/"+u}),d=!0):(D++,ee.open({type:"error",message:U({en:"Download failed",vi:"Lỗi tải"}),description:c})))}C++}d&&T++,k++,V.push({data:a,raw:e}),je((n=>({...n,[E(e)]:!0}))),fe((n=>n.filter((n=>E(n)!==E(e)))))}catch(i){D++,Y.error({content:U({en:"Download failed",vi:"Lỗi tải"})+": "+i.message})}}))),N||($+=t.length)}if(A=!0,"json"===s||"link"===s){const e=P+("json"===s?".json":".txt"),n="json"===s?JSON.stringify(V,null,4):R.join("\n");i((()=>import("./file-download-DzcmM7_q.js").then((e=>e.f))),__vite__mapDeps([10,1,2]),import.meta.url).then((t=>{t.default(n,e)}))}let W="";try{W=(null==F?void 0:F(b[$]||b[$-1]))||""}catch(q){console.error(q)}Y.destroy(w),Y.destroy(y),T>0&&ee.open({type:"info",message:U({en:"In Download/ folder",vi:"Trong folder Download/"})+": "+T,description:U({en:"Files that cannot be normal downloaded, will be force download into default Download folder of your browser",vi:"Những file không thể tải bình thường, sẽ được tải vào trong folder Download/ mặc định của trình duyệt"}),duration:0,btn:n.jsx(t,{onClick:a,children:U({en:"Show Download/ folder",vi:"Mở folder Download/"})})}),ee.open({type:"success",message:U(N?{en:"Download stopped",vi:"Đã dừng tải"}:{en:"Download finished",vi:"Tải xong"}),description:n.jsxs("ul",{children:[n.jsx("li",{children:U({en:"Folder name",vi:"Tên folder"})+": "+P}),n.jsx("li",{children:U({en:"Downloaded",vi:"Đã tải"})+": "+C}),T>0&&n.jsx("li",{children:U({en:"In Download/ folder",vi:"Trong folder Download/"})+": "+T}),n.jsx("li",{children:U({en:"Last index",vi:"Vị trí cuối"})+": "+($+r)}),n.jsx("li",{children:U({en:"Last cursor",vi:"Con trỏ cuối"})+": "+W})]}),duration:0,btn:n.jsx(m,{direction:"horizontal",children:N&&!ge?n.jsx(t,{onClick:()=>De({downloadType:s,fromCursor:W,startIndex:$+r}),children:U({en:"Continue download",vi:"Tiếp tục tải"})}):null})}),localStorage.setItem(P+"_fromCursor",W+""),localStorage.setItem(P+"_startIndex",$+r+"")},Te=ge&&(null==me?void 0:me.length)>0?me:se,$e=ge&&me.length?me.length:U({en:"all",vi:"tất cả"}),Ie=ge&&me.length?n.jsx(f.Text,{type:"secondary",children:U({en:`Download ${$e} selected items`,vi:`Tải ${$e} mục đang chọn`})}):n.jsx(f.Text,{type:"secondary",children:U({en:"Auto load more until nothing left",vi:"Tự động tải thêm cho đến khi không còn"})}),Se={items:[{key:"selectMode",label:n.jsxs(m,{align:"center",children:[n.jsxs(k,{placement:"left",title:U({en:"Select mode",vi:"Chọn để tải"}),content:U({en:n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsxs(g,{color:"success",children:[n.jsx("i",{className:"fa-solid fa-check"})," ON"]}),"Download only selected items"]}),n.jsxs("li",{children:[n.jsxs(g,{color:"warning",children:[n.jsx("i",{className:"fa-solid fa-xmark"})," OFF"]}),"Download all items (auto load more)"]}),n.jsxs("li",{children:["Shortcut:"," ",n.jsx(g,{style:{borderRadius:"9999px"},children:"Shift"})]})]}),vi:n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsxs(g,{color:"success",children:[n.jsx("i",{className:"fa-solid fa-check"})," BẬT"]}),"Chỉ tải những mục đã chọn"]}),n.jsxs("li",{children:[n.jsxs(g,{color:"warning",children:[n.jsx("i",{className:"fa-solid fa-xmark"})," TẮT"]}),"Tải tất cả (tự động tải thêm)"]}),n.jsxs("li",{children:["Phím tắt:"," ",n.jsx(g,{style:{borderRadius:"9999px"},children:"Shift"})]})]})}),children:[n.jsx(C,{checked:ge})," ",U({en:"Select mode",vi:"Chọn để tải"})]}),n.jsxs(m.Compact,{children:[me.length!==se.length&&n.jsx(x,{title:U({en:"Select all",vi:"Chọn tất cả"}),children:n.jsx(t,{onClick:e=>{e.preventDefault(),e.stopPropagation(),fe(se),xe(!0)},icon:n.jsx("i",{className:"fa-solid fa-check"}),children:se.length})}),(null==me?void 0:me.length)>0&&n.jsx(x,{title:U({en:"Clear selected",vi:"Bỏ chọn"}),children:n.jsx(t,{onClick:e=>{e.preventDefault(),e.stopPropagation(),fe([])},icon:n.jsx("i",{className:"fa-solid fa-trash"}),children:null==me?void 0:me.length})})]})]})},{type:"divider"},{key:"file",label:n.jsxs(m,{direction:"vertical",children:[n.jsx(f.Text,{strong:!0,children:"📁 "+U({en:`Download ${$e} files (photo/video)`,vi:`Tải ${$e} files (ảnh/video)`})}),Ie]})},{key:"link",label:n.jsxs(m,{direction:"vertical",children:[n.jsx(f.Text,{strong:!0,children:"🔗 "+U({en:`Export ${$e} links`,vi:`Xuất ${$e} links`})}),Ie]})},{key:"json",label:n.jsxs(m,{direction:"vertical",children:[n.jsx(f.Text,{strong:!0,children:"📄 "+U({en:`Export ${$e} to .json`,vi:`Xuất ${$e} ra .json`})}),Ie]})},{type:"divider"},...M.map((({key:e,label:n,labelFn:t})=>({key:e,label:(null==t?void 0:t(Te))||n})))],onClick:e=>{var n;if(M.length&&M.some((n=>n.key===e.key))){const t=null==(n=M.find((n=>n.key===e.key)))?void 0:n.onClick;t&&t(Te,re)}else"selectMode"===e.key?xe(!ge):!ge||(null==me?void 0:me.length)>0?De({downloadType:e.key}):Y.info(U({en:"Please select media to download",vi:"Vui lòng chọn ảnh/video muốn tải"}))}};return n.jsxs(m,{direction:"vertical",align:"center",style:{width:"100%"},className:Z?"collection-center":"",children:[null==W?void 0:W(se),n.jsxs(m.Compact,{style:{justifyContent:"center"},children:[B&&n.jsx(t,{onClick:()=>ye(!0),icon:n.jsx("i",{className:"fa-solid fa-rotate-right"}),disabled:ie,loading:ie,children:U(ie?{en:"Loading..",vi:"Đang tải.."}:{en:"Refresh",vi:"Làm mới"})}),L&&n.jsx(D,{disabled:!se.length,menu:Se,placement:"bottomCenter",children:n.jsx(t,{type:"primary",icon:n.jsx("i",{className:"fa-solid fa-download"}),children:ge?me.length?U({en:"Download",vi:"Tải xuống"})+` (${me.length})`:U({en:"Select to download...",vi:"Chọn để tải..."}):U({en:"Download all",vi:"Tải xuống"})})}),null==R?void 0:R(se,ie)]}),Q&&n.jsx(T.Search,{value:he,onChange:e=>ue(e.target.value+""),placeholder:U(X(se)),allowClear:!0,style:{minWidth:300}}),n.jsx($,{grid:{gutter:10,column:"vertical"===V?1:void 0},pagination:!!K&&{showTotal:(e,n)=>U({en:`Showing ${n[0]}-${n[1]} / Total ${e}`,vi:`Hiển thị ${n[0]}-${n[1]} / Tổng ${e}`}),defaultPageSize:J,showSizeChanger:!0,position:"bottom",align:"center"},dataSource:ve,renderItem:Ce,rowKey:E,loadMore:K||G?null:n.jsx(I,{justify:"center",children:n.jsxs(m,{direction:"vertical",align:"center",children:[n.jsxs(g,{color:"success",children:[U({en:"Total",vi:"Tổng"}),": ",se.length]}),we&&!K?n.jsx("div",{style:{height:500},children:n.jsx(p,{tip:U({en:"Loading",vi:"Đang tải"}),children:n.jsx("div",{style:{padding:50,background:"rgba(0, 0, 0, 0.05)",borderRadius:4}})})}):n.jsx(x,{placement:"bottom",title:U({en:n.jsxs(n.Fragment,{children:["🤔 If FB AIO does not load more automatically",n.jsx("br",{}),"👀 But you think there are more data",n.jsx("br",{}),"👆 Please click this button"]}),vi:n.jsxs(n.Fragment,{children:["🤔 Nếu FB AIO không tự động tải thêm nữa",n.jsx("br",{}),"👀 Nhưng bạn tin vẫn còn dữ liệu",n.jsx("br",{}),"👆 Hãy bấm nút này"]})}),mouseEnterDelay:.5,children:n.jsx(t,{icon:n.jsx("i",{className:"fa-solid fa-play"}),onClick:()=>ke(),loading:ie,children:U({en:"Load more",vi:"Tải thêm"})})})]})})})]})}export{P as DisplayType,_ as DownloadType,N as default};
