const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./VideoViewer-HdQ6aks3.js","./index-BoH2j3cU.js","./index-DY-hiTTZ.css","./videos-CoQTeQLu.js","./MyApp-D93h0aQZ.js"])))=>i.map(i=>d[i]);
import{r as e,bk as t,b3 as i,b4 as o,b8 as a,aQ as s,bs as n}from"./index-BoH2j3cU.js";import{genParams as r,extractItemList as l}from"./core-DWvzmykr.js";import{u as d,d as c,aI as m,B as u,I as h,c as g,S as p,e as v,f as w,aU as x,aS as j,T as f,A as k,s as y,k as b,t as I,x as T,v as C,aM as N,l as F,aN as $,aQ as q}from"./MyApp-D93h0aQZ.js";import S from"./MyTable-B-PXqHUM.js";import B from"./useCacheState-CRWoF5gI.js";import D from"./WordStatisticButton-DGDRooso.js";import{waitWinForReady as _,runFnInWin as R}from"./window-Dhlqh9T1.js";import{E as V}from"./ExportButton-bON9fXxS.js";import{checkVIP as P}from"./useVIP-f__zpoad.js";import{C as A}from"./index-CCn4Ygtp.js";import{L}from"./index-BJjUIN-g.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-7X6rB-D6.js";import"./row-B1CxNhq6.js";import"./BadgeWrapper-D2jAMD-I.js";import"./index-Q-uEsnt7.js";import"./index-DZ4ORVOX.js";import"./index-IueWr_3q.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-CXkkWBEB.js";import"./col-pZhDRk6E.js";const M=o((()=>s((()=>import("./VideoViewer-HdQ6aks3.js")),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),{fallback:b}),O="1.8";function U({target:o}){const{ti:s}=d(),{message:b,notification:U}=c(),[W,E]=B("TiktokUserVideos."+o.uniqueId,[]),[H,z]=B("TiktokUserVideos.loading",!1),J=e.useRef(null),Q=t.version>=O,K=async()=>{const e="TiktokUserVideos.onReload";I(e),z(!0),E([]),b.loading({key:e,content:s({en:"Loading...",vi:"Đang tải..."}),duration:0});try{J.current&&J.current.close();const t=window.open("https://www.tiktok.com/@"+o.uniqueId,"_blank","width=800,height=600");t.blur(),window.focus(),J.current=t,b.loading({key:e,content:s({en:"Waiting tiktok...",vi:"Đang chờ tiktok..."}),duration:0}),await _(t);let a="",n=0,d=!1;for(;!d&&!t.closed;){b.loading({key:e,content:i.jsxs(i.Fragment,{children:[s({en:"Fetching videos...",vi:"Đang tải videos..."})+n,i.jsx("br",{}),i.jsx("i",{children:s({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{d=!0}});const c=r({secUid:o.secUid,count:35,cursor:a,coverFormat:"2"}),m="https://www.tiktok.com/api/post/item_list/?"+Object.entries(c).map((e=>e.join("="))).join("&"),u=await R({win:t,fnPath:"fetch",params:[m,{credentials:"include"}],checkAbort:()=>d}),h=T(u);console.log(h);const g=l(null==h?void 0:h.itemList);if(!g.length)break;if(n+=g.length,E((e=>[...e,...g])),!(null==h?void 0:h.hasMore))break;a=null==h?void 0:h.cursor,await C(500)}t.closed?b.warning({content:s({en:"Tiktok window closed before done",vi:"Tab tiktok bị tắt trước khi chạy xong"})}):t.close(),U.open({type:"success",message:s({en:"Fetch tiktok videos completed",vi:"Tìm videos tiktok xong"}),description:o.uniqueId+" - "+n+" videos",duration:0})}catch(t){console.log(t),U.open({type:"error",message:s({en:"Failed to fetch tiktok videos",vi:"Lỗi tìm videos tiktok"}),description:o.uniqueId+" - "+t.message,duration:0})}finally{b.destroy(e),z(!1)}},X=e.useMemo((()=>{const e=W.filter((e=>e.image)).length;return[{title:"#",dataIndex:"index",key:"index",width:50},{title:`${W.filter((e=>e.video&&!e.image)).length} Video + ${e} Photo`,key:"video",render(e,t,o){var a;return i.jsx(u.Ribbon,{text:"Photo",color:"geekblue-inverse",style:{opacity:t.image?1:0},children:i.jsx(h,{src:(null==(a=t.image)?void 0:a.cover)||t.video.cover,fallback:t.video.cover,style:{width:180,height:200,objectFit:"cover",borderRadius:10},preview:{destroyOnClose:!0,imageRender:t.image?()=>{var e;return i.jsx(A,{style:{maxWidth:"90vw",maxHeight:"90vh",alignItems:"center",overflowY:"auto",overflowX:"hidden",padding:10,borderRadius:10},children:i.jsx(L,{grid:{gutter:10},style:{width:"100%"},dataSource:null==(e=t.image)?void 0:e.images,renderItem:(e,t)=>i.jsx(L.Item,{children:i.jsx(h,{src:e,style:{objectFit:"cover",width:250,height:250,borderRadius:10}})}),rowKey:e=>e})})}:()=>i.jsx(M,{info:t.video,defaultVariantTitle:{en:"Best",vi:"Tốt nhất"},style:{maxWidth:"90vw",maxHeight:"90vh"}}),toolbarRender:()=>null}})})},align:"center",width:180},{title:s({en:"Desc",vi:"Nội dung"}),dataIndex:"desc",key:"desc",render:(e,t,o)=>i.jsx(g.Text,{style:{maxWidth:250},children:t.desc}),width:250},{title:new Set(W.map((e=>{var t;return null==(t=e.music)?void 0:t.title}))).size+s({en:" Music",vi:" Nhạc"}),dataIndex:"music",key:"music",render(e,t,o){const{id:a,author:s,cover:n,original:r,playUrl:l,title:d}=t.music||{};return a?i.jsxs(p,{direction:"vertical",size:3,children:[i.jsx(h,{src:n,style:{width:50,height:50,borderRadius:10}}),i.jsxs(g.Text,{children:[s," ",d," ",r," ",!!l&&i.jsx(g.Link,{href:l,target:"_blank",children:i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})})]})]}):"-"},filters:m(W.map((e=>e.music)),"title"),onFilter:(e,t)=>{var i;return(null==(i=t.music)?void 0:i.title)===e},filterSearch:!0,width:150},{title:s({en:"Created",vi:"Ngày đăng"}),dataIndex:"createTime",key:"createTime",render:(e,t,o)=>i.jsxs(p,{direction:"vertical",size:3,children:[i.jsx(g.Text,{children:v(t.createTime)}),i.jsx(g.Text,{type:"secondary",children:w(t.createTime)})]}),sorter:(e,t)=>e.createTime-t.createTime,width:120},{title:i.jsx("i",{className:"fa-solid fa-play fa-lg"}),dataIndex:"views",key:"views",render:(e,t,i)=>x(t.stats.playCount),sorter:(e,t)=>e.stats.playCount-t.stats.playCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-heart fa-lg"}),dataIndex:"heart",key:"heart",render:(e,t,i)=>x(t.stats.diggCount),sorter:(e,t)=>e.stats.diggCount-t.stats.diggCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-comment fa-lg"}),dataIndex:"comments",key:"comments",render:(e,t,i)=>x(t.stats.commentCount),sorter:(e,t)=>e.stats.commentCount-t.stats.commentCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-bookmark fa-lg"}),dataIndex:"collect",key:"collect",render:(e,t,i)=>x(t.stats.collectCount),sorter:(e,t)=>e.stats.collectCount-t.stats.collectCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-share fa-lg"}),dataIndex:"shares",key:"shares",render:(e,t,i)=>x(t.stats.shareCount),sorter:(e,t)=>e.stats.shareCount-t.stats.shareCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-clock fa-lg"}),dataIndex:"length",key:"length",render:(e,t,i)=>j(t.video.duration),sorter:(e,t)=>e.video.duration-t.video.duration,width:70},{title:s({en:"Action",vi:"Hành động"}),dataIndex:"action",key:"action",render:(e,t,o)=>i.jsx(p.Compact,{children:i.jsx(f,{title:s({en:"Open on tiktok",vi:"Mở trong tiktok"}),children:i.jsx(a,{icon:i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"}),onClick:()=>{var e;window.open(`https://www.tiktok.com/@${null==(e=t.author)?void 0:e.uniqueId}/video/${t.video.id}`,"_blank")}})})}),width:90}]}),[W]);return i.jsx("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:Q?location.hostname.includes(".github.io")?i.jsx(k,{message:i.jsxs(i.Fragment,{children:[i.jsx(g.Text,{children:s({en:i.jsxs(i.Fragment,{children:["🚧 Please open"," ",i.jsxs("a",{href:"https://fb-aio.web.app/#/bulk-downloader",target:"_blank",children:[" ","This website"," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})," ","to download bulk Tiktok."]}),vi:i.jsxs(i.Fragment,{children:["🚧 Vui lòng mở"," ",i.jsxs("a",{href:"https://fb-aio.web.app/#/bulk-downloader",target:"_blank",children:[" ","Trang web này"," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})," ","để tải hàng loạt Tiktok."]})})})," ",i.jsxs("a",{href:"https://www.facebook.com/groups/fbaio/posts/1583865772268105",target:"_blank",children:[s({en:"Reason?",vi:"Lý do?"})," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})]}),type:"error",style:{alignSelf:"center",marginBottom:10}}):Q||(null==W?void 0:W.length)?i.jsx(S,{searchable:!0,selectable:!0,data:W.map(((e,t)=>({...e,index:t+1}))),columns:X,keyExtractor:e=>e.id,onSearchRow:(e,t)=>{var i,o;return[t.id,t.desc,null==(i=t.author)?void 0:i.nickname,null==(o=t.author)?void 0:o.uniqueId].find((t=>!!t&&y(e,t)))},renderTitle:e=>{const t=(null==e?void 0:e.length)?e:W,r=t.filter((e=>e.video&&!e.image));return i.jsxs(i.Fragment,{children:[i.jsx(a,{type:"primary",icon:i.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:K,loading:H,children:s({en:"Reload",vi:"Tải lại"})}),i.jsx(V,{title:s({en:"Download",vi:"Tải xuống"}),data:t,options:[{key:"videos",label:r.length+" videos",onClick:e=>{(async e=>{if(!(await P()))return;const t="TiktokUserVideos:downloadVideos";I(t);const a=e.map(((e,t)=>({name:t+"_"+N(e.desc||e.video.id||e.id)+".mp4",urls:(e.video.variants||[]).map((e=>[e.source,e.urls].flat().filter(Boolean))).flat().filter(Boolean)}))).filter((e=>e.urls.length));if(!a.length)return!1;const r=await window.showDirectoryPicker({mode:"readwrite"});await r.requestPermission({writable:!0});const l=await r.getDirectoryHandle(N(null==o?void 0:o.uniqueId),{create:!0}),d=t;b.loading({key:d,content:s({en:"Downloading...",vi:"Đang tải..."}),duration:0});let c=!1,m=0,u=0;const h=Math.min(5,a.length),g=Array.from({length:h},(()=>"")),p=a.map(((e,t)=>async(t,i)=>{for(let a of e.urls)try{g[i]=F(e.name,30);const t=await n(a,!0);a!==t&&console.log("redirected",a,t);const o=await $({url:t,checkAbortFn:()=>c}),s=o.headers.get("content-type");if("video/mp4"!==s)throw new Error("Invalid content type: "+s);const r=await o.blob(),d=await l.getFileHandle(e.name,{create:!0}),u=await d.createWritable();return await u.write(r),await u.close(),m++,!0}catch(o){console.log(o,e)}return u++,!1})),{start:v,stop:w}=q(h,p,1e3),x=setInterval((()=>{b.loading({key:d,content:i.jsxs(i.Fragment,{children:[s({en:`Downloading... ${m}/${a.length}. Failed: ${u}`,vi:`Đang tải... ${m}/${a.length}. Lỗi: ${u}`}),i.jsx("br",{}),i.jsx("i",{children:s({en:"Click to stop",vi:"Bấm để dừng"})}),i.jsx("br",{}),g.map(((e,t)=>i.jsxs("div",{style:{textAlign:"left"},children:[e,i.jsx("br",{})]},t)))]}),duration:0,onClick:()=>c=!0}),c&&w()}),500);await v(),clearInterval(x),b.destroy(d),U.open({type:"success",message:s(c?{en:"Stopped download tiktok videos",vi:"Đã dừng tải video tiktok"}:{en:"Downloaded tiktok videos",vi:"Tải xong video tiktok"}),description:`${null==o?void 0:o.uniqueId} (${m}/${a.length})`,duration:0})})(e)}},{key:"formatted json",label:".json (formatted)",prepareData:e=>({fileName:(null==o?void 0:o.uniqueId)+".json",data:JSON.stringify(e.map((e=>({...e,raw:void 0,video:{...e.video,raw:void 0}}))),null,4)})},{key:"raw json",label:".json (raw)",prepareData:e=>({fileName:(null==o?void 0:o.uniqueId)+".raw.json",data:JSON.stringify(e.map((e=>e.raw)),null,4)})}]}),i.jsx(D,{text:W.map((e=>e.desc)).join("\n")})]})}}):null:i.jsx(k,{message:s({vi:`Sắp có trong phiên bản v${O} (Bạn đang dùng v${t.version})`,en:`Coming soon in version v${O} (Current v${t.version})`}),type:"warning",showIcon:!0,style:{alignSelf:"center",marginBottom:10}})})}export{U as default};
