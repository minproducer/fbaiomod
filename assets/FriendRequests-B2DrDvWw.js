import{r as e,b3 as n,b8 as i,bl as t}from"./index-BoH2j3cU.js";import{u as s,d as c,t as r,v as a,s as o,S as l,I as d,i as u,f as m,e as h,b as g,T as x,h as p}from"./MyApp-D93h0aQZ.js";import f from"./MyTable-B-PXqHUM.js";import{F as j,g as k,a as y,d as v,b as T,c as C}from"./friendRequests-Hc954wLB.js";import E from"./useCacheState-CRWoF5gI.js";import{u as q}from"./useAction-B53X_KY4.js";import{u as I}from"./useDevMode-BCrlvjeP.js";import{S as b}from"./Screen-BEv7M6xj.js";import{A as N}from"./index-BMF_2O9_.js";import{R}from"./Table-CSd7eQib.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./row-B1CxNhq6.js";import"./useBreakpoint-CUrvcDr2.js";import"./index-7X6rB-D6.js";import"./SearchOutlined-BUONfEHJ.js";import"./useVIP-f__zpoad.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-CXkkWBEB.js";import"./index-IueWr_3q.js";import"./Dropdown-C4ZC00F-.js";import"./index-p3GZU5lJ.js";import"./index-BS-7HFpi.js";import"./index-BwkmqrWl.js";import"./col-pZhDRk6E.js";import"./index-DD15UiBp.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-DWB43XHw.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./Pagination-CIrtJa5e.js";const F={[j.INCOMING_REQUEST]:{vi:"Đã nhận",en:"Incoming",color:"default",icon:"fa-solid fa-arrow-turn-down"},[j.OUTGOING_REQUEST]:{vi:"Đã gửi",en:"Outgoing",color:"default",icon:"fa-solid fa-arrow-turn-up"},[j.DECLINED]:{vi:"Đã từ chối",en:"Declined",color:"error",icon:"fa-solid fa-xmark"},[j.ACCEPTED]:{vi:"Đã chấp nhận",en:"Accepted",color:"success",icon:"fa-solid fa-check"},[j.CANCELED]:{vi:"Đã huỷ",en:"Canceled",color:"error",icon:"fa-solid fa-xmark"}};function S(){const{ti:S}=s(),{message:D,notification:O}=c(),{onClickAction:A,onClickBulkActions:w}=q(),{devMode:G}=I(),[U,_]=E("FriendRequestType",j.INCOMING_REQUEST),[Q,L]=E("FriendRequests.incoming",[]),[M,$]=E("FriendRequests.outgoing",[]),[P,B]=E("FriendRequests.finished",!1),[W,z]=E("FriendRequests.loading",!1),[V,X]=E("FriendRequests.recordLoading",{});e.useEffect((()=>{P||Z(!1)}),[U,P]);const H=(e,n)=>X((i=>({...i,[e]:n}))),Z=async(e=!1)=>{const n="FriendRequests:onReload";r(n);const i=[[j.INCOMING_REQUEST,k,L,Q],[j.OUTGOING_REQUEST,y,$,M]].map((async([i,t,s,c])=>{var r;const o=F[i],l=n+i;try{const n=e?[]:c,i=n[n.length-1];let d=n.length,u=e?"":null==i?void 0:i.cursor;for(;;){D.loading({key:l,content:S({en:`Loading ${o.en} friend requests...`,vi:`Đang tải yêu cầu kết bạn ${o.vi}...`})+d,duration:0});const e=await t(u),i=new Set(n.map((e=>e.id))),c=e.filter((e=>!i.has(e.id)));if(!(null==c?void 0:c.length))break;n.push(...c),s([...n]),d=n.length,u=null==(r=n[n.length-1])?void 0:r.cursor,await a(500)}D.success({key:l,content:S({en:"Loaded friend requests "+o.en+": ",vi:"Tải xong yêu cầu kết bạn "+o.vi+": "})+d})}catch(d){O.open({type:"error",message:S({en:"Failed to load friend requests "+o.en+": ",vi:"Lỗi tải yêu cầu kết bạn "+o.vi+": "}),description:d.message})}}));z(!0),B(!1),await Promise.all(i),z(!1),B(!0)},J=(e,n=!1)=>(H(e.id,!0),A({key:"FriendRequests:onClickDeclineFriendRequest",id:e.id,record:e,loadingText:e=>S({en:"Declining friend request...",vi:"Đang từ chối yêu cầu kết bạn..."})+" "+e.name,successText:e=>S({en:"Declined friend request ",vi:"Từ chối yêu cầu thành công "})+" "+e.name,failedText:e=>S({en:"Failed to decline friend request: ",vi:"Lỗi từ chối yêu cầu kết bạn: "})+" "+e.name,actionFn:()=>G?a(1e3):v(e.id),onSuccess:()=>{L((n=>t(n,(n=>{const i=n.findIndex((n=>n.id===e.id));return i>=0&&(n[i].type=j.DECLINED),n}))))},finallyFn(){H(e.id,!1)},needConfirm:n,confirmProps:{title:S({en:"Decline friend request?",vi:"Từ chối yêu cầu kết bạn?"}),text:e.name}})),K=(e,n=!1)=>(H(e.id,!0),A({key:"FriendRequests:onClickAcceptFriendRequest",id:e.id,record:e,loadingText:e=>S({en:"Accepting friend request...",vi:"Đang đồng ý yêu cầu kết bạn..."})+" "+e.name,successText:e=>S({en:"Accepted friend request ",vi:"Đã đồng ý yêu cầu kết bạn "})+" "+e.name,failedText:e=>S({en:"Failed to accept friend request: ",vi:"Lỗi đồng ý yêu cầu kết bạn: "})+" "+e.name,actionFn:()=>G?a(1e3):T(e.id),onSuccess:()=>{L((n=>t(n,(n=>{const i=n.findIndex((n=>n.id===e.id));return i>=0&&(n[i].type=j.ACCEPTED),n}))))},finallyFn(){H(e.id,!1)},needConfirm:n,confirmProps:{title:S({en:"Accept friend request?",vi:"Đồng ý yêu cầu kết bạn?"}),text:e.name}})),Y=(e,n=!1)=>(H(e.id,!0),A({key:"FriendRequests:onClickCancelOutgoingRequest",id:e.id,record:e,loadingText:e=>S({en:"Canceling friend request...",vi:"Đang thu hồi yêu cầu kết bạn..."})+" "+e.name,successText:e=>S({en:"canceled friend request ",vi:"Đã thu hồi yêu cầu kết bạn "})+" "+e.name,failedText:e=>S({en:"Failed to cancel friend request: ",vi:"Lỗi thu hồi yêu cầu kết bạn: "})+" "+e.name,actionFn:()=>G?a(1e3):C(e.id),onSuccess:()=>{$((n=>t(n,(n=>{const i=n.findIndex((n=>n.id===e.id));return i>=0&&(n[i].type=j.CANCELED),n}))))},finallyFn(){H(e.id,!1)},needConfirm:n,confirmProps:{title:S({en:"Cancel friend request?",vi:"Thu hồi yêu cầu kết bạn?"}),text:e.name}})),ee=[{title:"#",key:"recent",dataIndex:"recent",render:(e,n,i)=>n.recent+1,sorter:(e,n)=>e.recent-n.recent,width:50},{title:S({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(e,n)=>(e.name||"").localeCompare(n.name||""),render:(e,i,t)=>n.jsxs(l,{align:"center",style:{maxWidth:300},children:[n.jsx(N,{shape:"square",src:n.jsx(d,{src:u(i.id),fallback:i.avatar}),size:50}),n.jsxs(l,{direction:"vertical",style:{marginLeft:"10px"},size:0,children:[n.jsx("a",{href:i.url,target:"_blank",children:n.jsx("b",{children:i.name})}),n.jsx("span",{style:{opacity:.5},children:i.id})]})]})},{title:S({en:"Description",vi:"Mô tả"}),key:"desc",dataIndex:"desc",sorter:(e,n)=>(e.desc||"").localeCompare(n.desc||""),render:(e,i,t)=>n.jsx("p",{style:{maxWidth:150,minWidth:100},children:i.desc}),width:"auto"},{title:S({en:"Time",vi:"Thời gian"}),key:"time",dataIndex:"time",sorter:(e,n)=>e.time-n.time,render:(e,i,t)=>i.time?n.jsxs(l,{direction:"vertical",children:[h(new Date(i.time).getTime()),n.jsx("span",{style:{opacity:.5},children:m(i.time)})]}):"-",onSearch:(e,n)=>o(e,m(n)),width:180},{title:S({en:"Status",vi:"Trạng thái"}),key:"type",dataIndex:"type",filters:(U===j.INCOMING_REQUEST?[j.INCOMING_REQUEST,j.ACCEPTED,j.DECLINED]:[j.OUTGOING_REQUEST,j.CANCELED]).map((e=>{const n=F[e],i=[...Q,...M].filter((n=>n.type===e)).length;return{text:S(n)+` (${i})`,value:e}})),onFilter:(e,n)=>n.type===e,render:(e,i,t)=>{const s=F[i.type];return n.jsx(g,{color:null==s?void 0:s.color,children:S(s)})},align:"right"},{title:S({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(e,t,s)=>t.type===j.INCOMING_REQUEST?n.jsxs(l.Compact,{children:[n.jsx(x,{title:S({en:"Accept",vi:"Đồng ý"}),children:n.jsx(i,{loading:V[t.id],onClick:()=>K(t,!0),icon:n.jsx("i",{className:"fa-solid fa-check"})})}),n.jsx(x,{title:S({en:"Decline",vi:"Từ chối"}),children:n.jsx(i,{danger:!0,loading:V[t.id],onClick:()=>J(t,!0),icon:n.jsx("i",{className:"fa-solid fa-trash-can"})})})]}):t.type===j.OUTGOING_REQUEST?n.jsx(l.Compact,{children:n.jsx(x,{title:S({en:"Cancel",vi:"Thu hồi"}),children:n.jsx(i,{danger:!0,loading:V[t.id],onClick:()=>Y(t,!0),icon:n.jsx("i",{className:"fa-solid fa-trash-can"})})})}):null,align:"right",width:100}];return n.jsxs(b,{title:S({en:"Friend Requests",vi:"Lời mời kết bạn"}),children:[n.jsx(R.Group,{defaultValue:U,buttonStyle:"solid",style:{marginBottom:10},children:[[j.INCOMING_REQUEST,Q],[j.OUTGOING_REQUEST,M]].map((([e,i])=>{const t=i.length;return n.jsxs(R.Button,{value:e,onClick:()=>{_(e)},children:[n.jsx("i",{className:F[e].icon})," ",S(F[e])," ",t]},e)}))}),n.jsx(f,{data:(U===j.INCOMING_REQUEST?Q:M).map(((e,n)=>({...e,recent:n}))),columns:ee,renderTitle:e=>{const t=(null==e?void 0:e.length)?[...e]:[...U===j.INCOMING_REQUEST?Q:M],s=t.filter((e=>e.type===j.INCOMING_REQUEST)),c=t.filter((e=>e.type===j.OUTGOING_REQUEST));return n.jsxs(n.Fragment,{children:[n.jsx(i,{type:"primary",icon:n.jsx("i",{className:"fa-solid fa-rotate-right"}),loading:W,onClick:()=>Z(!0),children:S({en:"Reload",vi:"Tải lại"})}),U===j.INCOMING_REQUEST?n.jsxs(l.Compact,{children:[n.jsx(x,{title:S({en:`Accept ${s.length} selected incoming requests`,vi:`Đồng ý ${s.length} lời mời đang chọn`}),children:n.jsx(i,{disabled:s.length<=0,icon:n.jsx("i",{className:"fa-solid fa-check"}),onClick:()=>{return w({data:e=s,key:"FriendRequests:onClickAcceptSelectedIncomingFriendRequests",actionFn:K,loadingText:(e,n,i)=>S({en:"Accepting incoming requests...",vi:"Đang đồng ý lời mời..."}),successText:(e,n)=>S({en:"Accepted incoming requests done: ",vi:"Đồng ý lời mời xong: "}),successDescItem:e=>n.jsx("a",{target:"_blank",href:p(e.id),children:e.name}),confirmProps:{title:S({en:`Accept ${e.length} incoming requests`,vi:`Đồng ý ${e.length} lời mời kết bạn`}),text:S({en:"Are your sure want to bulk accept?",vi:"Bạn có chãc muốn đồng ý hàng loạt?"})}});var e},children:s.length})}),n.jsx(x,{title:S({en:`Decline ${s.length} selected incoming requests`,vi:`Từ chối ${s.length} lời mời đang chọn`}),children:n.jsx(i,{danger:!0,disabled:s.length<=0,icon:n.jsx("i",{className:"fa-regular fa-trash-can"}),onClick:()=>{return w({data:e=s,key:"FriendRequests:onClickDeclineSelectedIncomingFriendRequests",actionFn:J,loadingText:(e,n,i)=>S({en:"Declining incoming requests...",vi:"Đang từ chối lời mời..."}),successText:(e,n)=>S({en:"Declined friend requests",vi:"Từ chối lời mời kết bạn xong"}),successDescItem:e=>n.jsx("a",{target:"_blank",href:p(e.id),children:e.name}),confirmProps:{title:S({en:`Decline ${e.length} selected incoming requests`,vi:`Từ chối ${e.length} lời mời đang chọn`}),text:S({en:"Are your sure want to bulk decline?",vi:"Bản có chãc muốn từ chối hàng loạt?"})}});var e},children:s.length})})]}):n.jsx(n.Fragment,{children:n.jsx(x,{title:S({en:`Cancel ${c.length} selected outgoing requests`,vi:`Thu hồi ${c.length} yêu cầu đang chọn`}),children:n.jsx(i,{danger:!0,disabled:c.length<=0,icon:n.jsx("i",{className:"fa-regular fa-trash-can"}),onClick:()=>{return w({data:e=c,key:"FriendRequests:onClickCancelSelectedOutgoingFriendRequests",actionFn:Y,loadingText:(e,n,i)=>S({en:"Canceling outgoing requests...",vi:"Đang thu hồi yêu cầu..."}),successText:(e,n)=>S({en:"Canceled outgoing requests",vi:"Thu hồi yêu cầu kết bạn xong"}),successDescItem:e=>n.jsx("a",{target:"_blank",href:p(e.id),children:e.name}),confirmProps:{title:S({en:`Cancel ${e.length} outgoing requests`,vi:`Thu hồi ${e.length} yêu cầu kết bạn`}),text:S({en:"Are your sure want to bulk cancel?",vi:"Bạn có chãc muốn thu hồi hàng loạt?"})}});var e},children:c.length})})}),n.jsx(x,{title:S({en:"View on Facebook",vi:"Xem trên Facebook"}),children:n.jsx(i,{icon:n.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/friends/requests","_blank")})})]})},size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e.id})]})}export{S as default};
