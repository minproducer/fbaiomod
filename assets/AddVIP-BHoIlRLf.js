import{r as e,aS as a,b3 as t,b8 as r}from"./index-BoH2j3cU.js";import{d as i,s as n,S as s,I as l,i as o,c as d,h as c,e as u,b as m,T as f,f as x,p as j,j as h}from"./MyApp-D93h0aQZ.js";import p from"./ProfileCard-BfFqUbs-.js";import{getUidFromUrl as v}from"./getIds-CXkkWBEB.js";import{d as g}from"./dayjs.min-BtTaSKBf.js";import y from"./MyTable-B-PXqHUM.js";import{C}from"./index-CCn4Ygtp.js";import{I as w}from"./index-7X6rB-D6.js";import{D as I}from"./index-B0u8UCO0.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./row-B1CxNhq6.js";import"./index-IueWr_3q.js";import"./ClockCircleOutlined-CoSdOHop.js";const k="fbaio-dev-pass";function S(){const{message:S}=i(),[b,P]=e.useState(""),[D,T]=e.useState(!1),[N,R]=e.useState(null),[V,E]=e.useState(""),[L,U]=e.useState(""),[$,M]=e.useState(g().add(3,"day")),[A,F]=e.useState(""),[B,O]=e.useState(localStorage.getItem(k)||""),[Y,_]=e.useState({}),[q,z]=e.useState(!1),[W,H]=e.useState([]),J=e.useRef(null);e.useEffect((()=>{localStorage.setItem(k,B)}),[B]),e.useEffect((()=>{localStorage.getItem(k)&&K()}),[]);const Z=e.useMemo((()=>{const e=W.filter((e=>{var a;return null==(a=e.name)?void 0:a.startsWith("referral from ")}));return W.map((a=>({...a,profile:Y[a.uid],referralCount:e.filter((e=>e.name=="referral from "+a.uid)).length})))}),[W,Y]),G=async e=>{if(e){T(!0);try{const a=await v(e);if(!a)throw new Error("Cannot get UID from URL");const t=await h(a);if(!t)throw new Error("Cannot get profile from UID: "+a);R(t),E(a),U(t.name)}catch(a){S.error(a.message)}finally{T(!1)}}},K=async()=>{const e="onPressLoad";S.loading({key:e,content:"Loading...",duration:0}),z(!0);try{const t=await fetch(a.FB_AIO.server+"/allVIP?password="+B),r=await t.json(),i=(new Date).getTime(),n=r.map(((e,a)=>{const t=parseInt(null==e?void 0:e[1]);return{index:a+1,uid:null==e?void 0:e[0],time:t,inVIP:t>i,name:null==e?void 0:e[2],referralCount:0}})).filter((e=>e.uid)).reverse();console.log(n),H(n),S.success({key:e,content:"Load success"})}catch(t){S.error({key:e,content:t.message})}finally{z(!1)}},Q=[{title:"#",dataIndex:"index",key:"index",sorter:(e,a)=>e.index-a.index,width:80},{title:"User",dataIndex:"uid",key:"uid",render:(e,a,r)=>t.jsxs(s,{children:[t.jsx(l,{src:o(a.uid,50),width:50,height:50,preview:{src:o(a.uid)}}),t.jsxs(s,{size:0,direction:"vertical",children:[t.jsx(d.Link,{href:c(a.uid),target:"_blank",strong:!0,children:t.jsx("b",{children:a.name})}),a.profile&&t.jsxs(d.Text,{children:["(",a.profile.name,")"]}),t.jsx(d.Text,{type:"secondary",children:a.uid})]})]}),filters:[{text:`Người chia sẻ (${W.filter((e=>{var a;return null==(a=e.name)?void 0:a.includes("referral of")})).length})`,value:"referral of"},{text:`Người được chia sẻ (${W.filter((e=>{var a;return null==(a=e.name)?void 0:a.includes("referral from")})).length})`,value:"referral from"},{text:`review (${W.filter((e=>{var a;return null==(a=e.name)?void 0:a.includes("review")})).length})`,value:"review"}],onFilter:(e,a)=>n(e,a.name)},{title:"Expire time",dataIndex:"inVIP",key:"inVIP",render:(e,a,r)=>{const i=new Date(parseInt(a.time)),n=u(i.getTime());return t.jsxs(s,{direction:"vertical",children:[t.jsx(m,{color:a.inVIP?"success":"error",children:t.jsxs(d.Text,{children:[a.inVIP?"":"-",n]})}),t.jsxs(d.Text,{type:"secondary",children:[a.time," - ",i.toLocaleString()]})]})},filters:[{text:`✅ ${W.filter((e=>e.inVIP)).length}`,value:!0},{text:`❌ ${W.filter((e=>!e.inVIP)).length}`,value:!1}],onFilter:(e,a)=>a.inVIP===e,sorter:(e,a)=>(parseInt(e.time)||0)-(parseInt(a.time)||0)},{title:"Ref count",dataIndex:"referralCount",key:"referralCount",sorter:(e,a)=>e.referralCount-a.referralCount,width:100},{title:"Action",dataIndex:"action",key:"action",render:(e,a,i)=>t.jsxs(s.Compact,{children:[t.jsx(f,{title:"Update",children:t.jsx(r,{icon:t.jsx("i",{className:"fa-solid fa-pen"}),onClick:()=>(e=>{P(e.uid),G(e.uid),M(g(Number(e.time)))})(a)})}),a.referralCount>0&&t.jsx(f,{title:"Show ref",children:t.jsx(r,{icon:t.jsx("i",{className:"fa-solid fa-users"}),onClick:()=>(e=>{var a;null==(a=J.current)||a.setSearch(e.uid)})(a)})}),!a.profile&&t.jsx(f,{title:"Reveal",children:t.jsx(r,{icon:t.jsx("i",{className:"fa-solid fa-eye"}),onClick:()=>(async e=>{const a="onPressReveal:"+e.uid;S.loading({key:a,content:"Revealing... "+e.name,duration:0});try{const t=await h(e.uid);if(!t)throw new Error("Cannot reveal: "+e.name);_((a=>({...a,[e.uid]:t}))),S.success({key:a,content:"Revealed: "+t.name})}catch(t){S.error({key:a,content:"Cannot reveal: "+e.name})}})(a)})})]})}],X=W.find((e=>e.uid==V));return t.jsxs("div",{children:[t.jsx("h1",{children:"Dev"}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[t.jsx(C,{style:{maxWidth:400},children:t.jsxs(s,{direction:"vertical",children:[t.jsx(w.Search,{value:b,onChange:e=>{const a=e.target.value;P(a),G(a)},onSearch:G,placeholder:"Enter FB URL",prefix:t.jsx("i",{className:"fa-brands fa-facebook"}),loading:D}),N&&t.jsx(p,{about:N,onClose:()=>{R(null)}}),t.jsx(w,{value:V,onChange:e=>E(e.target.value),placeholder:"UID",prefix:t.jsx("i",{className:"fa-solid fa-hashtag"}),allowClear:!0}),X&&t.jsx(d.Text,{type:"secondary",children:X.name}),t.jsx(w,{value:L,onChange:e=>U(e.target.value),placeholder:"NAME",prefix:t.jsx("i",{className:"fa-solid fa-user"}),allowClear:!0}),X&&t.jsxs(d.Text,{type:"secondary",children:[x(X.time)," (",X.time<$.toDate().getTime()?"ít hơn ":"nhiều hơn ",j(Math.abs(X.time-$.toDate().getTime())),")"]}),t.jsxs(s.Compact,{children:[t.jsx(I,{defaultValue:g(),format:"YYYY-MM-DD",value:$,onChange:M,prefix:t.jsx("i",{className:"fa-regular fa-calendar"}),allowClear:!1}),[{value:3,label:"3d"},{value:5,label:"5d"},{value:7,label:"7d"},{value:30,label:"1m"}].map((({value:e,label:a})=>t.jsx(r,{onClick:()=>{M(g().add(e,"day"))},children:a},e)))]}),t.jsxs(s.Compact,{children:[t.jsx(w,{value:A,onChange:e=>F(e.target.value),placeholder:"Reason",prefix:t.jsx("i",{className:"fa-solid fa-question"}),allowClear:!0}),["review","65k","3$"].map((e=>t.jsx(r,{onClick:()=>{F(e)},children:e},e)))]}),t.jsx(w.Password,{placeholder:"Password",onChange:e=>O(e.target.value),value:B,prefix:t.jsx("i",{className:"fa-solid fa-lock"}),allowClear:!0}),t.jsx(s,{style:{width:"100%",justifyContent:"flex-end"},children:t.jsx(r,{type:"primary",onClick:async()=>{const e="submit";S.loading({key:e,content:"Submitting...",duration:0});try{const t={uid:V,name:L+(A?` (${A})`:""),expireTime:$.toDate().getTime()+"",password:B},r=await fetch(a.FB_AIO.server+"/addVIP?"+new URLSearchParams(t)),i=await r.text();console.log(i),S.info({key:e,content:i})}catch(t){S.error({key:e,content:t.message})}},disabled:!L||!V||!B,children:"Submit"})})]})}),t.jsx("hr",{}),t.jsx(y,{ref:J,columns:Q,data:Z,searchable:!0,virtual:!0,pageSize:5,keyExtractor:e=>""+(null==e?void 0:e.uid),onSearchRow:(e,a)=>{var t;return n(e,(null==a?void 0:a.name)+(null==a?void 0:a.uid)+(null==(t=null==a?void 0:a.profile)?void 0:t.name))},renderTitle:()=>t.jsx(r,{onClick:K,disabled:!B,loading:q,icon:t.jsx("i",{className:"fa-solid fa-sync"}),children:"Reload"})})]})]})}export{S as default};
