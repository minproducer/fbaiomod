import{aW as e,bf as n,r as i,b3 as o,b8 as t,bn as a}from"./index-BoH2j3cU.js";import{u as r,d as s,v as l,I as d,S as m,c,g as p,T as u,A as g,o as h,t as j}from"./MyApp-D93h0aQZ.js";import{u as v}from"./useForceStop-BT3l6lDG.js";import f from"./MyTable-B-PXqHUM.js";import{E as x}from"./ExportButton-bON9fXxS.js";import y,{getCacheByKey as b}from"./useCacheState-CRWoF5gI.js";import{getOtherJoinedGroups as k,getMyManagedGroups as C,UserTypeInGroup as w,getMyJoinedGroups as _}from"./groups-D329Q9FY.js";import G from"./WordStatisticButton-DGDRooso.js";import{B as N}from"./BadgeWrapper-D2jAMD-I.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-7X6rB-D6.js";import"./row-B1CxNhq6.js";import"./index-Q-uEsnt7.js";import"./index-DZ4ORVOX.js";import"./index-IueWr_3q.js";function S({target:S}){const{message:T}=e.useApp(),D=n(),F=v(),{ti:B}=r(),{notification:I}=s(),[E,J]=i.useState(!1),[M,A]=y("JoinedGroups.data."+(null==S?void 0:S.id),[]),[L,$]=y("JoinedGroups.myGroupLoaded",!1),[P,W]=y("Groups.data",[]),[O,z]=i.useState(!1),H=i.useMemo((()=>{const e=new Set(P.map((e=>e.id)));return M.map((n=>({...n,isCommonGroup:e.has(n.id)})))}),[M,P]);i.useEffect((()=>{var e;(null==S?void 0:S.id)&&R(!(null==(e=b("JoinedGroups.data."+(null==S?void 0:S.id)))?void 0:e.length))}),[null==S?void 0:S.id]);const R=async(e=!1)=>{var n;if(!(null==S?void 0:S.id))return;const i=F.start();let o=[...e?[]:b("JoinedGroups.data."+(null==S?void 0:S.id))||[]],t=(null==(n=o[o.length-1])?void 0:n.cursor)||"";J(!0);try{for(;!i.value();){const e=await k({uid:S.id,cursor:t});if(!(null==e?void 0:e.length))break;t=e[e.length-1].cursor,o=[...o,...e].map(((e,n)=>({...e,recent:n}))),A(o),await l(500)}T.success({content:B({en:"Load groups success ",vi:"Tải nhóm xong "})+o.length})}catch(a){T.error({content:B({en:"Error: ",vi:"Lỗi: "})+a.message})}finally{A(o),J(!1)}},q=async()=>{var e;const n="JoinedGroups.onClickFindCommonGroups";j(n),z(!0);const i=[],o=new Set;for(const[t,a]of[[C,w.ADMIN],[_,w.MEMBER]]){let a="";for(;;){T.loading({key:n,content:B({en:"Finding common groups...",vi:"Đang tìm nhóm chung..."})+i.length,duration:0});const r=await t({cursor:a}),s=null==r?void 0:r.filter((e=>!o.has(e.id)));if(r.forEach((e=>o.add(e.id))),!(null==s?void 0:s.length))break;i.push(...s),a=null==(e=null==i?void 0:i[(null==i?void 0:i.length)-1])?void 0:e.cursor,W([...i]),await l(500)}}z(!1),$(!0),T.destroy(n),I.open({type:"success",message:B({en:"Find common groups success",vi:"Hoàn tất tìm nhóm chung"}),description:B({en:'Please use filter in column "Common groups"',vi:'Vui lòng sử dụng bộ lọc ở cột "Nhóm chung"'}),duration:0})},K=[{title:"#",dataIndex:"recent",key:"recent",render:(e,n,i)=>(n.recent||0)+1,sorter:(e,n)=>e.recent-n.recent,width:60},{title:B({en:"Cover",vi:"Ảnh"}),key:"cover",dataIndex:"image",render:(e,n,i)=>o.jsx(d,{src:n.image,style:{width:150,height:100,objectFit:"contain"}}),width:150},{title:B({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n,i)=>o.jsxs(m,{direction:"vertical",style:{maxWidth:250},children:[o.jsx(c.Link,{strong:!0,href:n.url,target:"_blank",children:n.name}),o.jsx(c.Text,{type:"secondary",children:n.id})]})},{title:B({en:"Description",vi:"Mô tả"}),key:"description",dataIndex:"description",render:(e,n,i)=>o.jsx("p",{style:{width:250},children:e}),sorter:(e,n)=>(e.description||"").localeCompare(n.description||"")},{title:B({en:"Members",vi:"Thành viên"}),key:"membersCount",dataIndex:"membersCount",sorter:(e,n)=>e.membersCount-n.membersCount,render:(e,n,i)=>p(e),align:"end",width:120},...P.length||L?[{title:H.filter((e=>e.isCommonGroup)).length+B({en:" Common groups",vi:" Nhóm chung"}),key:"common",dataIndex:"common",render:(e,n,i)=>n.isCommonGroup?"✅":"❌",filters:[{text:`✅ (${H.filter((e=>e.isCommonGroup)).length})`,value:!0},{text:`❌ (${H.filter((e=>!e.isCommonGroup)).length})`,value:!1}],onFilter:(e,n)=>n.isCommonGroup==e,width:150,align:"right"}]:[],{title:B({en:"Actions",vi:"Hành động"}),key:"actions",render:(e,n,i)=>o.jsx(m.Compact,{children:o.jsx(u,{title:B({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:o.jsx(t,{type:"default",onClick:()=>{return e=n.id,void D("/bulk-downloader",{state:{targetId:e,platform:a.Facebook}});var e},icon:o.jsx("i",{className:"fa-solid fa-download"})})})}),width:100,align:"end"}];return o.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[o.jsx(g,{type:"success",showIcon:!0,message:B({en:`Joined ${H.length} public groups`,vi:`Đã tham gia ${H.length} nhóm công khai`}),style:{alignSelf:"center",marginBottom:10}}),o.jsx(f,{columns:K,data:H,keyExtractor:e=>null==e?void 0:e.id,searchable:!0,selectable:!0,pageSize:5,renderTitle:e=>o.jsxs(o.Fragment,{children:[o.jsx(t,{disabled:E,type:"primary",icon:E?o.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):o.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>R(!0),children:B({en:"Reload",vi:"Tải lại"})}),o.jsx(x,{data:e.length?e:H,options:[{key:"uid",label:".txt (id)",prepareData:e=>({fileName:(null==S?void 0:S.name)+"_joined_groups_id.txt",data:e.map((e=>e.id)).join("\n")})},{key:"id_name",label:".csv (id+name)",prepareData:e=>({fileName:(null==S?void 0:S.name)+"_joined_groups_id_name.csv",data:h(e.map((e=>({uid:e.id,name:e.name}))))})},{key:"name_desc",label:".csv (name+desc)",prepareData:e=>({fileName:(null==S?void 0:S.name)+"_joined_groups.csv",data:h(e.map((e=>({name:e.name,desc:e.description}))))})},{key:"json",label:".json",prepareData:e=>({fileName:(null==S?void 0:S.name)+"_joined_groups.json",data:JSON.stringify(e,null,4)})},{key:"csv",label:".csv",prepareData:e=>({fileName:(null==S?void 0:S.name)+"_joined_groups.csv",data:h(e)})}]}),o.jsx(N,{type:"new",children:o.jsx(u,{title:B({en:"Find common groups of "+(null==S?void 0:S.name)+" with you",vi:"Tìm nhóm chung của "+(null==S?void 0:S.name)+" với bạn"}),children:o.jsx(t,{loading:O,icon:o.jsx("i",{className:"fa-solid fa-magnifying-glass"}),onClick:q,children:B({en:"Find common groups",vi:"Tìm nhóm chung"})})})}),o.jsx(G,{name:"JoinedGroups",text:H.map((e=>{var n,i;return[e.name,null==(i=null==(n=e.description)?void 0:n.replace)?void 0:i.call(n,e.name,"")]})).flat().filter(Boolean).join("\n")})]})})]})}export{S as default};
