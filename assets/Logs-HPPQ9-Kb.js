import{r as e,b3 as t,b8 as i,aS as n}from"./index-BoH2j3cU.js";import{d as r,aI as s,S as o,i as l,c as a,h as d,b as u,t as c}from"./MyApp-D93h0aQZ.js";import m from"./MyTable-B-PXqHUM.js";import{d as p}from"./dayjs.min-BtTaSKBf.js";import g from"./useCacheState-CRWoF5gI.js";import{A as x}from"./index-BMF_2O9_.js";import{D as f}from"./index-B0u8UCO0.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-7X6rB-D6.js";import"./row-B1CxNhq6.js";import"./index-DD15UiBp.js";import"./ClockCircleOutlined-CoSdOHop.js";function j(){const{message:j}=r(),[N,E]=g("Logs.time",p().format("YYYY-MM-DD")),[L,k]=g("Logs.allLogs."+N,[]),[w,D]=g("Logs.loading."+N,!1);e.useEffect((()=>{}),[]);const M=e.useMemo((()=>({version:s(L,"version"),eventName:s(L,"eventName"),uid:s(L,"uid")})),[L]),O=e=>{E(e.format("YYYY-MM-DD"))},b=[{title:"#",dataIndex:"i",key:"i",width:50},{title:"time",dataIndex:"timeString",key:"timeString",width:100},{title:M.version.length+" version",dataIndex:"version",key:"version",width:80,filters:M.version,onFilter:(e,t)=>t.version===e},{title:M.uid.length+" users",dataIndex:"uid",key:"uid",render:(e,i,n)=>t.jsxs(o,{children:[t.jsx(x,{shape:"square",src:l(i.uid,40),size:40}),t.jsx(a.Link,{href:d(i.uid),target:"_blank",children:i.uid})]}),width:200,filters:M.uid,onFilter:(e,t)=>t.uid===e},{title:M.eventName.length+" events",dataIndex:"eventName",key:"eventName",width:200,filters:M.eventName,onFilter:(e,t)=>t.eventName===e,filterSearch:!0,render:(e,i,n)=>null==e?void 0:e.split(":").map(((e,i)=>t.jsxs(u,{color:["blue","green","red","orange"][i],children:[0==i?"":":",e]},i)))},{title:"isScript",dataIndex:"isScript",key:"isScript",render:(e,t,i)=>e?"✅":"❌",filters:[{text:"✅ "+L.filter((e=>e.isScript)).length,value:!0},{text:"❌ "+L.filter((e=>!e.isScript)).length,value:!1}],onFilter:(e,t)=>t.isScript===e,width:50},{title:"total",dataIndex:"totalCount",key:"totalCount",width:70}];return t.jsxs("div",{children:[t.jsx("h3",{children:"Logs"}),t.jsxs("p",{children:[L.length," logs"]}),t.jsx(m,{columns:b,data:L,virtual:!0,searchable:!0,renderTitle:()=>t.jsxs(t.Fragment,{children:[t.jsx(i,{loading:w,onClick:()=>(async(e=!1)=>{if(!e&&L.length)return;const t="Logs:onReload:"+N;c(t),D(!0),j.loading({key:t,content:"Loading logs..."+N,duration:0});const i=await fetch(n.FB_AIO.server+"/log/"+N),r=(await i.text()).split("<br/>").filter((e=>e)).map((e=>e.trim()));if(console.log(r),!r.length)return console.log("no logs");"Log not found"!=r[0]&&r[0];const s=r.map(((e,t)=>{const i=h(e).replace(/\d+\/\d+\/\d+, /,""),n=null==i?void 0:i.split(" ")[1];let r=parseInt(null==i?void 0:i.split(":")[0])+("PM"==n?12:0);12==r&&"AM"==n&&(r=0);const s={i:t,log:e,uid:v(e),time:new Date(h(e)),timeString:i,hour:r,eventName:S(e),version:I(e),totalCount:parseInt(C(e))||0,isScript:y(e),fbName:"",fbAvatar:"",logPretty:""},o=s.eventName.replace("("+s.version+")","").trim(),l=function(e,t,i=" "){return e+(t-e.length>0?i.repeat(t-e.length):"")}(s.version,4," ");return s.logPretty=l&&o?`${s.timeString} | ${l} | ${o} - ${s.totalCount}`:s.log,s}));k(s),D(!1),j.success({key:t,content:"Loaded "+s.length+" logs: "+N})})(!0),icon:t.jsx("i",{className:"fa-solid fa-rotate-right"}),children:"Reload"}),t.jsx(f,{defaultValue:p(),format:"YYYY-MM-DD",value:p(N),onChange:O,prefix:t.jsx("i",{className:"fa-regular fa-calendar"}),allowClear:!1})]}),keyExtractor:e=>e.uid+e.log})]})}function v(e){var t;return(null==(t=/-(\d+)\)/.exec(e))?void 0:t[1])||"?"}function h(e){var t;return(null==(t=/\d{1,2}\/\d{1,2}\/\d{4}, \d{1,2}:\d{1,2}:\d{1,2} \w{2}/.exec(e))?void 0:t[0])||""}function S(e){var t;return(null==(t=/: (.*?) \(/.exec(e))?void 0:t[1])||""}function C(e){var t;return(null==(t=/ -> (\d+)/.exec(e))?void 0:t[1])||""}function I(e){var t;return(null==(t=/ \((.*?)-\d*\)/.exec(e))?void 0:t[1])||""}function y(e){return!(e.includes("INSTALLED")||e.includes("OPEN-")||e.includes("CLICK_")||e.includes("-INFO")||e.includes("-FAVORITE")||e.includes("-VIEW-SOURCE")||e.includes("CHECK-FOR-UPDATE")||e.includes("RESTORE")||e.includes("BACKUP")||e.includes("CHANGE-THEME")||e.includes("CHANGE-SMOOTH-SCROLL")||e.includes("getVIP"))}export{j as default};
