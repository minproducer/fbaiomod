const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MyApp-D93h0aQZ.js","./index-BoH2j3cU.js","./index-DY-hiTTZ.css"])))=>i.map(i=>d[i]);
import{aQ as e,aW as a,bf as t,r as i,b3 as l,b8 as n,bn as o}from"./index-BoH2j3cU.js";import{u as r,t as s,I as d,S as c,c as p,T as u,A as m,o as v}from"./MyApp-D93h0aQZ.js";import{u as h}from"./useForceStop-BT3l6lDG.js";import g from"./MyTable-B-PXqHUM.js";import{E as f}from"./ExportButton-bON9fXxS.js";import j,{getCacheByKey as x}from"./useCacheState-CRWoF5gI.js";import"./index-CLQrWQaN.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-7X6rB-D6.js";import"./row-B1CxNhq6.js";async function _({uid:a="",cursor:t=""}){const{fetchGraphQl:i}=await e((async()=>{const{fetchGraphQl:e}=await import("./MyApp-D93h0aQZ.js").then((e=>e.aY));return{fetchGraphQl:e}}),__vite__mapDeps([0,1,2]),import.meta.url),l=await i({fb_api_req_friendly_name:"ProfileCometAppCollectionListRendererPaginationQuery",variables:{cursor:t,count:8,scale:2,search:null,id:btoa("app_collection:"+a+":302324425790:103")},doc_id:"25969811035995761"}),{parseSafe:n}=await e((async()=>{const{parseSafe:e}=await import("./MyApp-D93h0aQZ.js").then((e=>e.aX));return{parseSafe:e}}),__vite__mapDeps([0,1,2]),import.meta.url),o=n(l),{findDataObject:r}=await e((async()=>{const{findDataObject:e}=await import("./MyApp-D93h0aQZ.js").then((e=>e.a_));return{findDataObject:e}}),__vite__mapDeps([0,1,2]),import.meta.url),{edges:s=[],page_info:d={}}=r(o);return s.map((e=>{var a,t,i,l,n,o,r,s,c,p,u,m,v,h,g,f,j,x;return{id:null==(a=null==e?void 0:e.node)?void 0:a.id,pageId:null==(i=null==(t=null==e?void 0:e.node)?void 0:t.node)?void 0:i.id,pageName:null==(n=null==(l=null==e?void 0:e.node)?void 0:l.title)?void 0:n.text,place:null==(c=null==(s=null==(r=null==(o=null==e?void 0:e.node)?void 0:o.subtitle_text)?void 0:r.text)?void 0:s.split("\n"))?void 0:c[0],image:null==(u=null==(p=null==e?void 0:e.node)?void 0:p.image)?void 0:u.uri,url:(null==(m=null==e?void 0:e.node)?void 0:m.url)||(null==(h=null==(v=null==e?void 0:e.node)?void 0:v.node)?void 0:h.url),timeString:null==(x=null==(j=null==(f=null==(g=null==e?void 0:e.node)?void 0:g.subtitle_text)?void 0:f.text)?void 0:j.split("\n"))?void 0:x[1],cursor:(null==e?void 0:e.cursor)||(null==d?void 0:d.end_cursor)}}))}function y({target:e}){const{ti:y}=r(),{message:k}=a.useApp(),w=t(),b=h(),[I,S]=i.useState(!1),[C,N]=j("CheckedIns.data."+(null==e?void 0:e.id),[]),P=i.useMemo((()=>{const e=new Map,a=new Map;return C.forEach((t=>{e.has(t.place)||e.set(t.place,t),a.has(t.pageId)||a.set(t.pageId,t)})),{allPlaces:Array.from(e.values()),allPages:Array.from(a.values())}}),[C]);i.useEffect((()=>{var a;(null==e?void 0:e.id)&&D(!(null==(a=x("CheckedIns.data."+(null==e?void 0:e.id)))?void 0:a.length))}),[null==e?void 0:e.id]);const D=async(a=!1)=>{var t,i;if(!(null==e?void 0:e.id))return;const l=b.start();let n=[...a?[]:x("CheckedIns.data."+(null==e?void 0:e.id))||[]],o=(null==(t=n[n.length-1])?void 0:t.cursor)||"";s("CheckedIns:onReload"),S(!0);try{for(;!l.value();){const a=await _({uid:e.id,cursor:o});if(!(null==a?void 0:a.length))break;o=null==(i=a[a.length-1])?void 0:i.cursor,n=[...n,...a].map(((e,a)=>({...e,recent:a}))),N(n)}}catch(r){k.error({content:y({en:"Error: ",vi:"Lỗi: "})+r.message})}finally{N(n),S(!1)}},A=[{title:"#",dataIndex:"recent",key:"recent",render:(e,a,t)=>(a.recent||0)+1,sorter:(e,a)=>e.recent-a.recent,width:60},{title:y({en:"Cover",vi:"Ảnh"}),key:"cover",dataIndex:"image",render:(e,a,t)=>l.jsx(d,{src:a.image,style:{width:120,height:120,objectFit:"contain"}}),width:120},{title:P.allPages.length+" "+y({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",sorter:(e,a)=>e.pageName.localeCompare(a.pageName),render:(e,a,t)=>l.jsxs(c,{direction:"vertical",style:{maxWidth:250},children:[l.jsx(p.Link,{href:a.url,target:"_blank",children:l.jsx("b",{children:a.pageName})}),l.jsx("span",{style:{opacity:.6},children:a.pageId})]}),filters:P.allPages.map((e=>{let a=C.filter((a=>a.pageId===e.pageId)).length;return{count:a,value:e.pageId,text:e.pageName+" ("+a+")"}})).sort(((e,a)=>a.count-e.count)),onFilter:(e,a)=>a.pageId==e,filterSearch:!0},{title:P.allPlaces.length+" "+y({en:"Place",vi:"Địa điểm"}),key:"place",dataIndex:"place",sorter:(e,a)=>e.place.localeCompare(a.place),filters:P.allPlaces.map((e=>{let a=C.filter((a=>a.place===e.place)).length;return{count:a,value:e.place,text:e.place+" ("+a+")"}})).sort(((e,a)=>a.count-e.count)),onFilter:(e,a)=>a.place==e,filterSearch:!0,width:200},{title:y({en:"Time",vi:"Thời gian"}),key:"timeString",dataIndex:"timeString",sorter:(e,a)=>e.timeString.localeCompare(a.timeString),width:250},{title:y({en:"Actions",vi:"Hành động"}),key:"actions",render:(e,a,t)=>l.jsxs(c.Compact,{children:[l.jsx(u,{title:y({en:"Show map",vi:"Xem bản đồ"}),children:l.jsx(n,{type:"default",onClick:()=>{window.open("https://www.google.com/maps/search/"+a.pageName,"_blank")},icon:l.jsx("i",{className:"fa-solid fa-location-dot"})})}),l.jsx(u,{title:y({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:l.jsx(n,{type:"default",onClick:()=>{return e=a.pageId,void w("/bulk-downloader",{state:{targetId:e,platform:o.Facebook}});var e},icon:l.jsx("i",{className:"fa-solid fa-download"})})})]}),width:100,align:"end"}];return l.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[l.jsx(m,{type:"success",showIcon:!0,message:y({en:`Checked in ${C.length} times`,vi:`Đã check in ${C.length} lần`}),style:{alignSelf:"center",marginBottom:10}}),l.jsx(g,{columns:A,data:C,keyExtractor:e=>e.id,searchable:!0,pageSize:3,renderTitle:a=>l.jsxs(l.Fragment,{children:[l.jsx(n,{disabled:I,type:"primary",icon:I?l.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):l.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>D(!0),children:y({en:"Reload",vi:"Tải lại"})}),l.jsx(f,{data:a.length?a:C,options:[{key:"id",label:".txt (page id)",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in_id.txt",data:a.map((e=>e.pageId)).join("\n")})},{key:"id_name",label:".csv (page id+name)",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in_id_name.csv",data:v(a.map((e=>({page:e.pageId,name:e.pageName,place:e.place}))))})},{key:"json",label:".json",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in.json",data:JSON.stringify(a,null,4)})},{key:"csv",label:".csv",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in.csv",data:v(a)})}]}),l.jsx(n,{onClick:()=>{var a;(null==(a=null==e?void 0:e.url)?void 0:a.includes("?id="))?window.open((null==e?void 0:e.url)+"&sk=map","_blank"):window.open((null==e?void 0:e.url)+"/map","_blank")},icon:l.jsx("i",{className:"fa fa-external-link-alt"}),children:y({vi:"Xem trên Facebook",en:"View on Facebook"})},"view-fb")]})})]})}export{y as default};
