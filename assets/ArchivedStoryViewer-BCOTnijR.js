const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./StoryViewers-CPADPUz0.js","./index-BoH2j3cU.js","./index-DY-hiTTZ.css","./MyApp-D93h0aQZ.js","./Collection-CEHJdMiC.js","./index-CLQrWQaN.js","./useCacheState-CRWoF5gI.js","./react-hotkeys-hook.esm-V0Xz-7zA.js","./index-DD15UiBp.js","./index-p3GZU5lJ.js","./index-BS-7HFpi.js","./index-DWB43XHw.js","./Dropdown-C4ZC00F-.js","./PurePanel-DNUOZ5MP.js","./move-DCq-oE7y.js","./index-7X6rB-D6.js","./SearchOutlined-BUONfEHJ.js","./index-BJjUIN-g.js","./useBreakpoint-CUrvcDr2.js","./index-CTitp5Qg.js","./List-BGWr2xJE.js","./index-UsPtaxTh.js","./DownOutlined-DRGhK8zp.js","./row-B1CxNhq6.js","./Pagination-CIrtJa5e.js","./col-pZhDRk6E.js","./index-BwkmqrWl.js","./stories-BXTaFV6b.js","./index-BMF_2O9_.js","./VideoWithMuted-B9CeRI4b.js"])))=>i.map(i=>d[i]);
import{aW as e,aV as i,aT as t,r as s,b3 as r,b4 as a,b8 as o,aQ as n}from"./index-BoH2j3cU.js";import{u as l,S as c,I as d,c as x,f as h,h as m,i as j,k as u}from"./MyApp-D93h0aQZ.js";import f from"./useCacheState-CRWoF5gI.js";import{getArchivedStoriesContent as p}from"./stories-BXTaFV6b.js";import{A as y}from"./index-BMF_2O9_.js";import{T as g}from"./index-IueWr_3q.js";import"./useBreakpoint-CUrvcDr2.js";import"./index-DD15UiBp.js";import"./Dropdown-C4ZC00F-.js";const v=a((()=>n((()=>import("./StoryViewers-CPADPUz0.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)),{fallback:u}),b=a((()=>n((()=>import("./VideoWithMuted-B9CeRI4b.js")),__vite__mapDeps([29,1,2]),import.meta.url)),{fallback:u});function w({story:a}){const{ti:n}=l(),{message:u}=e.useApp(),w=i(t.darkMode),[_,k]=f("ArchivedStoryViewer.stories."+a.creation_time,[]),[T,A]=f("ArchivedStoryViewer.viewingIndex."+a.id,0),[R,N]=s.useState(!1),V=_[T]||_[0],S=V?Object.values(V.viewer_count).reduce(((e,i)=>e+i),0):0,I=V?V.reactions.reduce(((e,i)=>e+i.count),0):0,E=T<_.length-1,L=T>0,D=0===_.length&&!R,C=s.useRef(!1);s.useEffect((()=>{(null==_?void 0:_.length)||!a.creation_time||C.current||(N(!0),C.current=!0,p({creationTime:a.creation_time}).then((e=>{if(e){const i=e.findIndex((e=>e.id===a.id));k(e),A(i)}})).catch((e=>u.error(n({en:"Error: ",vi:"Lỗi: "}))+e.message)).finally((()=>{N(!1),C.current=!1})))}),[]);const F={height:"70vh",width:"calc(70vh * 9 / 16)"},O=s.useRef(null),$=V?[{key:"story",label:r.jsxs(x.Text,{children:[r.jsx("i",{className:"fa fa-play"})," Play"]}),children:r.jsxs(c,{direction:"vertical",style:{position:"relative"},children:[V.video?r.jsx(b,{src:V.video,style:{...F,borderRadius:10,objectFit:"contain"}}):V.image_background?r.jsxs(c,{direction:"vertical",style:{position:"relative"},children:[r.jsx(d,{src:V.image_background,preview:!1,style:{...F,borderRadius:10,objectFit:"contain"}}),r.jsx(d,{src:V.image,style:{...F,borderRadius:10,objectFit:"contain",position:"absolute",bottom:0,left:0,transform:"translate(-50%, 0)",opacity:.5}})]}):r.jsx(d,{src:V.image,style:{...F,borderRadius:10,objectFit:"contain"}}),r.jsx(c,{direction:"vertical",align:"start",style:{background:"linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%)",position:"absolute",top:0,left:0,padding:10,width:"100%",paddingBottom:"50px",borderRadius:10},children:[V.comment_count?{icon:r.jsx("i",{className:"fa-solid fa-message"}),text:V.comment_count}:null,V.music?{icon:r.jsx("i",{className:"fa-solid fa-music"}),text:V.music}:null].filter(Boolean).map(((e,i)=>e&&r.jsxs(x.Text,{style:{color:"#eee",textAlign:"left"},children:[e.icon," ",e.text]},"story-statistic-"+i)))})]})},{key:"viewer",label:r.jsxs(x.Text,{children:[r.jsx("i",{className:"fa fa-eye"})," ",S," "]}),children:r.jsxs(c,{direction:"vertical",style:{...F,width:450,overflowY:"auto",overflowX:"hidden",textAlign:"left",position:"relative"},children:[r.jsxs(x.Text,{children:[n({en:"Views",vi:"Lượt xem"}),":"]}),r.jsx("ul",{children:Object.entries(V.viewer_count).map((([e,i])=>r.jsx("li",{children:r.jsxs(x.Text,{style:{color:"#eee"},children:[e,": ",i]})},"story-viewer-"+e)))}),r.jsx(c,{direction:"horizontal",style:{display:"flex",padding:10,alignItems:"center"},children:r.jsxs(x.Text,{style:{textDecoration:"underline"},children:[n({en:"Created date",vi:"Ngày đăng"}),r.jsx(x.Text,{style:{position:"absolute",right:10},children:h(new Date(V.created_at))})]})}),r.jsx(v,{storyId:V.id,initialViewers:V.viewers})]})},{key:"reactions",label:r.jsxs(x.Text,{children:[r.jsx("i",{className:"fa fa-heart"})," ",I," "]}),children:r.jsxs(c,{direction:"vertical",style:{overflowY:"auto",...F},align:"start",children:[r.jsxs(x.Text,{children:[n({en:"Reactions",vi:"Lượt thích"}),":"]}),V.reactions.map(((e,i)=>r.jsxs(x.Link,{href:m(e.uid),style:{padding:"0 5px 5px",display:"block"},target:"_blank",children:[r.jsx(y,{src:j(e.uid,50),size:35}),r.jsx(x.Text,{style:{color:"#eee",textAlign:"left"},children:` ${e.count} ${e.reactions}`},"story-reaction-"+i)]},"story-reaction-"+i)))]})}]:[];return r.jsxs(c,{direction:"vertical",style:{maxHeight:"100vh",overflowY:"auto",overflowX:"hidden",minWidth:F.width,minHeight:F.height,background:w?"#222":"#eee",color:w?"white":"#111",padding:10,borderRadius:10},ref:O,children:[r.jsxs(x.Text,{children:["Archived Story Viewer"," ",R?r.jsx("i",{className:"fa fa-spinner fa-spin"}):`(${T+1}/${_.length})`]}),D&&r.jsx("div",{children:"No data"}),V&&r.jsxs(c,{children:[r.jsx(o,{disabled:!L,onClick:()=>{A(T-1)},children:r.jsx("i",{className:"fa fa-chevron-left"})}),r.jsx(g,{defaultActiveKey:"story",items:$}),r.jsx(o,{disabled:!E,onClick:()=>{A(T+1)},children:r.jsx("i",{className:"fa fa-chevron-right"})})]})]})}export{w as default};
