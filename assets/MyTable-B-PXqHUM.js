import{r as e,b3 as t,b8 as n}from"./index-BoH2j3cU.js";import{u as l,s as r,c as i,S as s}from"./MyApp-D93h0aQZ.js";import{u as a}from"./index-CLQrWQaN.js";import{T as o}from"./index-DFDl0PJq.js";import{F as c}from"./Table-CSd7eQib.js";import{R as u}from"./row-B1CxNhq6.js";import{I as d}from"./index-7X6rB-D6.js";import"./DownOutlined-DRGhK8zp.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";const h=e.forwardRef(((h,m)=>{const{ti:p,language:f}=l(),{virtual:g=!1,data:S=[],columns:x=[],size:y="middle",selectable:v=!1,searchable:j=!1,searchPlaceholder:w=p({en:"Search",vi:"Tìm kiếm"}),loading:k=!1,pageSize:b=0,keyExtractor:C=(e,t)=>t+"",onSearchRow:R,renderTitle:_,style:B,footer:D,expandable:T}=h,[z,F]=e.useState(""),[I,M]=e.useState(""),[E,P]=e.useState([]),[H,O]=e.useState(!1),[q,K]=e.useState(!1),L=a(F,500),U=e.useRef(!1),$=e=>{M(e),L(e),U.current=!0};e.useImperativeHandle(m,(()=>({getDataSelected:()=>E,setDataSelected:e=>{P(e)},hasDataSelected:()=>!!(null==E?void 0:E.length),setShowSelectedOnly:O,setSearch:$,clearFilter:({search:e=!0,dataSelected:t=!0,showSelectedOnly:n=!0}={})=>{e&&$(""),t&&P([]),n&&O(!1)}})));const A=e.useMemo((()=>{const e=new Map(x.map(((e,t)=>[e.key,t]))),t=(z?S.filter((t=>R?R(z,t):Object.entries(t).some((([n,l],i)=>{var s,a;let o=e.get(n)||-1;return!(o<0)&&(!(null==(s=x[o])?void 0:s.disableSearch)&&((null==(a=x[o])?void 0:a.onSearch)?x[o].onSearch(z,l,t,q):"string"==typeof l&&(q?null==l?void 0:l.includes(z):r(z,l))))})))):S).map(((e,t)=>({...e,key:C(e,t)})));if(H&&(null==E?void 0:E.length)){const e=new Set(E.map(C));return t.filter(((t,n)=>e.has(C(t,n))))}return t}),[S,z,q,H,E,x,C,R]),W=e.useMemo((()=>x.find((e=>e.rangeFilter))?x.map((e=>e.rangeFilter?{...e,filterDropdown:({setSelectedKeys:e,selectedKeys:l,confirm:r,clearFilters:s})=>{var a,c;return t.jsxs("div",{style:{padding:8},children:[t.jsx(i.Text,{strong:!0,style:{marginBottom:8,display:"block"},children:p({en:"Range filter",vi:"Lọc giá trị"})}),t.jsx(o,{placeholder:p({vi:"Bé nhất",en:"Min"}),value:(null==(a=l[0])?void 0:a.min)??null,onChange:t=>e([{...l[0],min:t}]),style:{marginBottom:8,display:"block",width:"100%"}}),t.jsx(o,{placeholder:p({vi:"Lớn nhất",en:"Max"}),value:(null==(c=l[0])?void 0:c.max)??null,onChange:t=>e([{...l[0],max:t}]),style:{marginBottom:8,display:"block",width:"100%"}}),t.jsx(n,{type:"primary",size:"small",onClick:r,style:{width:90,marginRight:8},children:p({en:"Apply",vi:"Áp dụng"})}),t.jsx(n,{type:"link",size:"small",onClick:s,style:{width:90},children:p({en:"Reset",vi:"Đặt lại"})})]})},onFilter:(t,n)=>{const{min:l,max:r}=t||{},i=e.rangeFilter.getValue(n);return i>=(l??-1/0)&&i<=(r??1/0)},filterIcon:e=>t.jsx("i",{className:"fa fa-filter",style:{color:e?"#1890ff":void 0}})}:e)):x),[x]);e.useEffect((()=>{if(!(null==E?void 0:E.length))return;let e=new Set(S.map(C)),t=E.filter(((t,n)=>e.has(C(t,n))));(null==t?void 0:t.length)!==(null==E?void 0:E.length)&&P(t)}),[S,E]),e.useEffect((()=>{!(null==E?void 0:E.length)&&H&&O(!1)}),[E.length,H]);const N=e.useRef([]),V=e.useRef([]),Z=e.useRef(!1);e.useEffect((()=>{!Z.current&&(null==E?void 0:E.length)&&V.current.push(E),Z.current=!1,N.current=E}),[E]);const G=e.useRef(A),J=e.useRef(A);e.useEffect((()=>{if(z){const e=new Set(A.map(C)),t=new Set(G.current.map(C)),n=new Set([...e].filter((e=>t.has(e))));J.current=G.current.filter((e=>n.has(C(e))))}else J.current=A,G.current=A}),[A,z]);const Q=(e,t)=>{const n=new Set(S.map(C)),l=new Set(A.map(C)),r=new Set(N.current.map(C)),i=new Set(e),s=new Set([...n].filter((e=>!l.has(e)))),a=new Set([...e].filter((e=>!r.has(e)))),o=new Set([...r].filter((e=>!i.has(e)&&!s.has(e)))),c=[...r,...a].filter((e=>!o.has(e))).map((e=>S.find((t=>C(t)===e)))).filter(Boolean);P(c)},X=e.useMemo((()=>{if(!v)return;const e=[{key:"undo",text:p({en:"Undo selected",vi:"Hoàn tác lựa chọn"}),onSelect:()=>{Z.current=!0;const e=V.current.pop();console.log(e),P(V.current[V.current.length-1]||[])}},{key:"select_all",text:p({en:"Select all",vi:"Chọn tất cả"})+" ("+S.length+")",onSelect:()=>P([...J.current])},{key:"invert_selection",text:p({en:"Invert selection",vi:"Đảo ngược lựa chọn"}),onSelect:()=>P(J.current.filter((e=>!E.find((t=>C(t)===C(e))))))},{key:"unselect_all",text:p({en:"Unselect all",vi:"Bỏ chọn tất cả"}),onSelect:()=>{O(!1);const e=new Set(J.current.map(C));P(E.filter((t=>!e.has(C(t)))))}},{key:"show_selected_only",text:(H?"✅ ":"❌ ")+p({en:"Show selected only",vi:"Chỉ hiển thị đã chọn"})+" ("+E.length+")",onSelect:()=>{$(""),O(!H)}}].filter(Boolean);return z&&e.push({key:"select_all_insearch",text:p({en:"Select all - search results",vi:"Chọn tất cả - kết quả tìm kiếm"})+" ("+A.length+")",onSelect:()=>P([...J.current])},{key:"invert_selection_insearch",text:p({en:"Invert selection - search results",vi:"Đảo ngược lựa chọn - kết quả tìm kiếm"}),onSelect:()=>P(J.current.filter((e=>!E.find((t=>C(t)===C(e))))))},{key:"unselect_all_insearch",text:p({en:"Unselect all - search results",vi:"Bỏ chọn tất cả - kết quả tìm kiếm"}),onSelect:()=>{O(!1);const e=new Set(J.current.map(C));P(E.filter((t=>!e.has(C(t)))))}}),{selectedRowKeys:E.map(C),onChange:Q,selections:e,type:"checkbox",getCheckboxProps:e=>({style:{minWidth:50,minHeight:50,alignItems:"center",justifyContent:"center"}})}}),[S,A,E,H,v,f,z,Q]);return t.jsx(c,{sticky:{offsetHeader:0},fixedHeader:!0,size:y,loading:k,tableLayout:"auto",dataSource:A,columns:W,showSorterTooltip:!1,rowKey:C,onChange:(e,t,n,l)=>{J.current=l.currentDataSource??[],G.current=l.currentDataSource??[]},virtual:g,scroll:g?{x:"max-content",y:500}:{x:"max-content"},rowSelection:X,title:()=>t.jsxs(u,{justify:"space-between",style:{margin:"5px"},gutter:[8,8],align:"middle",children:["function"==typeof _&&t.jsx(u,{align:"middle",children:t.jsx(s,{wrap:!0,children:_(E)})}),j&&t.jsx(s,{children:t.jsx(d.Search,{placeholder:w,value:I,onChange:e=>$(e.target.value),style:{maxWidth:300}})})]}),pagination:!g&&(-1!=b&&{position:["bottomCenter"],showSizeChanger:!0,showTotal:(e,t)=>p({en:`Total ${e} items`,vi:`Tổng ${e} dòng`}),size:"default",defaultPageSize:b||10,style:{alignItems:"center"}}),style:B,footer:D?()=>D:void 0,expandable:T})}));export{h as default};
