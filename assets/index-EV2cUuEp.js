import{bf as e,r as i,b3 as n,b8 as t,bl as a,bn as s}from"./index-BoH2j3cU.js";import{d as l}from"./dayjs.min-BtTaSKBf.js";import{d as o,u as r,t as d,I as c,S as m,c as g,b as h,h as p,T as u,s as x,v,o as f}from"./MyApp-D93h0aQZ.js";import{u as j}from"./useForceStop-BT3l6lDG.js";import y from"./useCacheState-CRWoF5gI.js";import{E as k}from"./ExportButton-bON9fXxS.js";import{getPageInvites as T,UserTypeInPage as b,getMyLikedPages as D,unlikePage as I,unFollowPage as w,declinePageInvite as N}from"./pages-Cap3TVHx.js";import L from"./WordStatisticButton-DGDRooso.js";import C from"./MyTable-B-PXqHUM.js";import{u as P}from"./useAction-B53X_KY4.js";import{u as U}from"./useDevMode-BCrlvjeP.js";import{S as E}from"./Screen-BEv7M6xj.js";import{P as F}from"./index-DSCn1aBo.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./BadgeWrapper-D2jAMD-I.js";import"./index-Q-uEsnt7.js";import"./index-DZ4ORVOX.js";import"./index-IueWr_3q.js";import"./index-DFDl0PJq.js";import"./DownOutlined-DRGhK8zp.js";import"./index-CLQrWQaN.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-CTitp5Qg.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-7X6rB-D6.js";import"./row-B1CxNhq6.js";import"./useVIP-f__zpoad.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-CXkkWBEB.js";import"./index-BwkmqrWl.js";import"./col-pZhDRk6E.js";import"./index-DD15UiBp.js";function S(){const{devMode:S}=U(),{message:B}=o(),M=e(),{ti:A}=r(),{onClickAction:_,onClickBulkActions:Y}=P(),R=j(),[$,O]=y("Pages.data",[]),[W,H]=y("Pages.finished",!1),[K,V]=i.useState(!1),z=i.useMemo((()=>$.map(((e,i)=>({...e,index:i+1})))),[$]);i.useEffect((()=>{W||q(!1)}),[]);const q=async(e=!1)=>{var i;if(K&&!e)return;const n=R.start(),t=e?[]:[...z],a=new Set(t.map((e=>e.id))),s="Pages:onReload";d(s),V(!0),H(!1);try{B.loading({key:s,content:A({en:"Loading invited pages...",vi:"Đang tải trang được mời..."}),duration:0});const l=await T(),o=null==l?void 0:l.filter((e=>!a.has(e.id)));(null==o?void 0:o.length)&&(t.push(...o),O([...t]));const r=null==t?void 0:t.filter((e=>e.userType!==b.INVITED)).pop();let d=e?"":null==r?void 0:r.cursor;for(;!n.value();){B.loading({key:s,content:A({en:"Loading pages...",vi:"Đang tải trang..."})+t.length,duration:0});const e=await D(d),n=null==e?void 0:e.filter((e=>!a.has(e.id)));if(e.forEach((e=>a.add(e.id))),!(null==n?void 0:n.length))break;t.push(...n),d=null==(i=null==t?void 0:t[(null==t?void 0:t.length)-1])?void 0:i.cursor,O([...t])}B.success({key:s,content:(n.value()?A({en:"Load pages stopped ",vi:"Dừng tải trang "}):A({en:"Load pages completed ",vi:"Tải xong trang "}))+t.length}),H(!n.value())}catch(l){B.error({content:A({en:"Failed to load pages: ",vi:"Lỗi tải trang: "})+l.message})}finally{V(!1)}},Q=(e,i=!1)=>_({record:e,id:e.id,key:"Pages:onClickUnlikePage",actionFn:()=>S?v(1e3):I(e.id),loadingText:()=>A({en:"Unliking page... ",vi:"Đang bỏ thích trang..."})+e.name,successText:()=>A({en:"Unliked page ",vi:"Đã bỏ thích trang "})+e.name,failedText:()=>A({en:"Failed to unlike page ",vi:"Lỗi bỏ thích trang "})+e.name,onSuccess:()=>{O((i=>a(i,(i=>{const n=i.findIndex((i=>i.id==e.id));return i[n].userType=b.UNLIKED,i}))))},needConfirm:i,confirmProps:{title:A({en:"Unlike ",vi:"Bỏ thích "})+e.name+"?"}}),G=(e,i=!1)=>_({record:e,id:e.id,key:"Pages:onClickUnfollowPage",actionFn:()=>S?v(1e3):w(e.id),loadingText:()=>A({en:"Unfollowing page... ",vi:"Đang bỏ theo dõi trang..."})+e.name,successText:()=>A({en:"Unfollowed page ",vi:"Đã bỏ theo dõi trang "})+e.name,failedText:()=>A({en:"Failed to unfollow page",vi:"Lỗi bỏ theo dõi trang"}),onSuccess:()=>{O((i=>a(i,(i=>{const n=i.findIndex((i=>i.id==e.id));return i[n].userType=b.UNFOLLOWED,i}))))},needConfirm:i,confirmProps:{title:A({en:"Unfollow ",vi:"Bỏ theo dõi "})+e.name+"?"}}),J=async(e,i=!1)=>_({record:e,id:e.id,key:"Pages:onClickDeclineInvite",actionFn:()=>S?v(1e3):N(e.inviteId),loadingText:()=>A({en:"Declining invite... ",vi:"Đang từ chối lời mời..."})+e.name,successText:()=>A({en:"Declined invite ",vi:"Đã từ chối lời mời "})+e.name,failedText:()=>A({en:"Failed to remove invite",vi:"Lỗi từ chối lời mời"}),onSuccess:()=>{O((i=>a(i,(i=>{const n=i.findIndex((i=>i.id==e.id));return i[n].userType=b.DECLINED,i}))))},needConfirm:i,confirmProps:{title:A({en:"Decline ",vi:"Từ chối lời mời "})+e.name+"?"}}),Z=e=>{switch(e){case b.ADMIN:return{color:"success",text:A({en:"Admin",vi:"Admin"})};case b.LIKED:return{color:"default",text:A({en:"Liked",vi:"Đã thích"})};case b.INVITED:return{color:"warning",text:A({en:"Invited",vi:"Lời mời"})};case b.DECLINED:return{color:"error",text:A({en:"Declined",vi:"Từ chối"})};case b.UNLIKED:return{color:"error",text:A({en:"Unliked",vi:"Bỏ thích"})};case b.UNFOLLOWED:return{color:"error",text:A({en:"Unfollowed",vi:"Bỏ theo dõi"})};default:return{color:"default",text:"?"}}},X=i.useMemo((()=>Array.from(z.map((e=>e.category)).reduce(((e,i)=>{let n=e.get(i)||0;return e.set(i,++n)}),new Map).entries()).sort(((e,i)=>i[1]-e[1])).map((([e,i])=>({text:e+" ("+i+")",value:e})))),[z]),ee=[{title:"#",key:"index",dataIndex:"index",sorter:(e,i)=>e.index-i.index,width:60},{title:A({en:"Image",vi:"Ảnh"}),key:"image",dataIndex:"image",render:(e,i,t)=>n.jsx(c,{src:i.image,width:50,height:50,style:{objectFit:"contain",borderRadius:5}})},{title:A({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",render:(e,i,t)=>n.jsxs(m,{direction:"vertical",size:0,style:{maxWidth:300},children:[n.jsx(g.Link,{href:i.url,target:"_blank",children:n.jsx("b",{children:i.name||"???"})}),n.jsx("span",{style:{opacity:.5},children:i.id})]}),sorter:(e,i)=>e.name.localeCompare(i.name)},{title:A({en:"Category",vi:"Danh mục"})+" ("+X.length+")",key:"category",dataIndex:"category",filters:X,onFilter:(e,i)=>i.category==e,filterSearch:!0},{title:A({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,i,t)=>{const{color:a,text:s}=Z(i.userType);return i.inviterId?n.jsxs(m,{children:[n.jsx(h,{color:a,children:s}),n.jsx(c,{src:i.inviterAvatar,width:40,height:40,style:{borderRadius:5}}),n.jsxs(m,{direction:"vertical",size:0,children:[n.jsx(g.Link,{href:p(i.inviterId),target:"_blank",children:n.jsx("b",{children:i.inviterName})}),n.jsx("span",{style:{opacity:.5},children:i.inviterId})]})]}):n.jsx(h,{color:a,children:s})},filters:Object.values(b).map((e=>{const{text:i}=Z(e);return{text:i+" ("+z.filter((i=>i.userType==e)).length+")",value:e}})),onFilter:(e,i)=>i.userType==e,align:"left"},{title:A({en:"Action",vi:"Hành động"}),key:"action",render:(e,i,a)=>n.jsxs(m.Compact,{style:{minWidth:30},children:[i.userType===b.LIKED||i.userType===b.ADMIN?n.jsxs(n.Fragment,{children:[i.canLike?n.jsx(u,{title:A({en:"Unlike page",vi:"Bỏ thích"}),children:n.jsx(t,{onClick:()=>Q(i,!0),icon:n.jsx("i",{className:"fa-solid fa-thumbs-down"})})}):null,n.jsx(u,{title:A({en:"Unfollow page",vi:"Bỏ theo dõi"}),children:n.jsx(t,{onClick:()=>G(i,!0),icon:n.jsx("i",{className:"fa-solid fa-eye-slash"})})})]}):null,i.userType===b.INVITED?n.jsx(u,{title:A({en:"Decline invite",vi:"Từ chối"}),children:n.jsx(t,{danger:!0,onClick:()=>J(i,!0),icon:n.jsx("i",{className:"fa-solid fa-xmark"})})}):null,n.jsx(u,{title:A({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:n.jsx(t,{type:"default",onClick:()=>(e=>{M("/bulk-downloader",{state:{targetId:e.id,platform:s.Facebook}})})(i),icon:n.jsx("i",{className:"fa-solid fa-download"})})})]}),width:100,align:"right"}];return n.jsx(E,{title:A({en:"Pages manager",vi:"Quản lý trang"}),titleSuffix:n.jsx(h,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:z.length}),children:n.jsx(C,{data:z,columns:ee.map(((e,i)=>({...e,index:i}))),renderTitle:e=>{var i,a;const s=(null==e?void 0:e.length)?[...e]:[...z],o=(null==(i=null==s?void 0:s.map((e=>z.find((i=>i.id===e.id)))))?void 0:i.filter((e=>(null==e?void 0:e.userType)===b.LIKED||(null==e?void 0:e.userType)===b.ADMIN)))||[],r=(null==o?void 0:o.filter((e=>null==e?void 0:e.canLike)))||[],c=(null==(a=null==s?void 0:s.map((e=>z.find((i=>i.id===e.id)))))?void 0:a.filter((e=>(null==e?void 0:e.userType)===b.INVITED)))||[];return n.jsxs(n.Fragment,{children:[n.jsx(u,{color:"red",title:A({en:"WARNING: Reload many times may cause temporarily blocked by facebook",vi:"LƯU Ý: Tải lại nhiều lần có thể bị facebook chặn tạm thời"}),children:n.jsx(t,{type:"primary",icon:K?n.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):n.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>q(!0),children:A({en:"Reload",vi:"Tải lại"})})}),n.jsx(k,{data:s,options:[{key:"id",label:".txt (page id)",prepareData:e=>({fileName:"your_pages_id"+l().format("YYYY-MM-DD-HHmmss")+".txt",data:null==e?void 0:e.map((e=>e.id)).join("\n")})},{key:"id_name",label:".csv (id+name)",prepareData:e=>({fileName:"my_liked_pages_id_name.csv",data:f(e.map((e=>({uid:e.id,name:e.name}))))})},{key:"json",label:".json",prepareData:e=>({fileName:"your_pages"+l().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(e,null,4)})},{key:"csv",label:".csv",prepareData:e=>({fileName:"your_pages"+l().format("YYYY-MM-DD-HHmmss")+".csv",data:f(e)})}]}),n.jsx(u,{title:A({en:`Unlike ${r.length} selected pages`,vi:`Bỏ thích ${r.length} trang được chọn`}),children:n.jsx(t,{danger:!0,disabled:r.length<=0,icon:n.jsx("i",{className:"fa-solid fa-thumbs-down"}),onClick:()=>(async e=>Y({data:e,key:"Pages:onClickUnlikeSelectedPages",actionFn:Q,loadingText:()=>A({en:"Unliking pages... ",vi:"Đang bỏ thích trang... "}),successText:()=>A({en:"Unliked pages done: ",vi:"Bỏ thích trang xong: "}),successDescItem:e=>e.name,confirmProps:{title:A({en:"Unlike "+e.length+" pages?",vi:"Bỏ thích "+e.length+" trang?"})}}))(r),children:r.length})}),n.jsx(u,{title:A({en:`Unfollow ${o.length} selected pages`,vi:`Bỏ theo dõi ${o.length} trang được chọn`}),children:n.jsx(t,{danger:!0,disabled:o.length<=0,icon:n.jsx("i",{className:"fa-solid fa-eye-slash"}),onClick:()=>(async e=>Y({data:e,key:"Pages:onClickUnfollowSelectedPages",actionFn:G,loadingText:()=>A({en:"Unfollowing pages... ",vi:"Đang bỏ theo dõi trang... "}),successText:()=>A({en:"Unfollowed pages done: ",vi:"Bỏ theo dõi trang xong: "}),successDescItem:e=>e.name,confirmProps:{title:A({en:"Unfollow "+e.length+" pages?",vi:"Bỏ theo dõi "+e.length+" trang?"})}}))(o),children:o.length})}),c.length>0&&n.jsx(u,{title:A({en:`Decline ${c.length} selected invites`,vi:`Từ chối ${c.length} lời mời được chọn`}),children:n.jsx(F,{title:A({en:`Decline ${c.length} invites`,vi:`Từ chối ${c.length} lời mời`}),description:A({en:`Are your sure want to decline ${c.length} invites?`,vi:`Bản có chãc muốn từ chối ${c.length} lời mời?`}),onConfirm:()=>(async e=>Y({data:e,key:"Pages:onClickDeclineSelectedInvites",actionFn:J,loadingText:()=>A({en:"Removing invite... ",vi:"Đang từ chối lời mời... "}),successText:()=>A({en:"Declined invites done: ",vi:"Từ chối lời mời xong: "}),successDescItem:e=>e.name,confirmProps:{title:A({en:"Remove invite "+e.length+" pages?",vi:"Từ chối lời mời "+e.length+" trang?"})}}))(c),okText:A({en:"Yes",vi:"Có"}),cancelText:A({en:"No",vi:"Huỷ"}),children:n.jsx(t,{danger:!0,disabled:c.length<=0,icon:n.jsx("i",{className:"fa-solid fa-xmark"}),children:c.length})})}),n.jsx(L,{name:"Pages",text:z.map((e=>e.name)).join(" ")}),n.jsx(u,{title:A({en:"Manage on Facebook",vi:"Quản lý trên Facebook"}),children:n.jsx(t,{onClick:()=>{d("Pages:openManageOnFacebook"),window.open("https://www.facebook.com/me/allactivity?category_key=LIKEDINTERESTS","_blank")},icon:n.jsx("i",{className:"fa-solid fa-up-right-from-square"})})})]})},size:"small",searchable:!0,selectable:!0,onSearchRow:(e,i)=>x(e,(null==i?void 0:i.name)+(null==i?void 0:i.id)),keyExtractor:e=>(null==e?void 0:e.id)+(null==e?void 0:e.userType)})})}export{S as default};
