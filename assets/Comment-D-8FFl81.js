const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./WordStatisticButton-DGDRooso.js","./index-BoH2j3cU.js","./index-DY-hiTTZ.css","./MyApp-D93h0aQZ.js","./BadgeWrapper-D2jAMD-I.js","./index-Q-uEsnt7.js","./index-DZ4ORVOX.js","./PurePanel-DNUOZ5MP.js","./index-IueWr_3q.js","./Dropdown-C4ZC00F-.js","./index-DFDl0PJq.js","./DownOutlined-DRGhK8zp.js","./ImageLazyPreview-BzCZNgqu.js","./useCacheState-CRWoF5gI.js","./VideoViewer-HdQ6aks3.js","./videos-CoQTeQLu.js"])))=>i.map(i=>d[i]);
import{r as e,b3 as t,b8 as n,bl as i,b4 as r,aQ as l}from"./index-BoH2j3cU.js";import{CommentIntentToken as o,getPostComments as s,CommentAttachmentType as a,IdentityBadgeType as d,IdentityBadgeTypeNames as c,getReplyComments as m,CommentIntentTokenNames as h}from"./comments-Db0f97Vq.js";import{u,d as p,S as g,T as x,I as v,i as y,c as j,h as f,e as b,f as k,b as w,g as T,z as C,A as R,s as _,B as I,v as $,aH as S,k as A,l as F}from"./MyApp-D93h0aQZ.js";import L from"./MyTable-B-PXqHUM.js";import N from"./useCacheState-CRWoF5gI.js";import{G as E}from"./gender-D7cqwEK5.js";import{E as O}from"./ExportButton-bON9fXxS.js";import{R as D}from"./reactions-CXN7tjxZ.js";import{getLargestPhoto as V}from"./photos-jBKQrPG2.js";import{R as z}from"./row-B1CxNhq6.js";import{A as B}from"./index-BMF_2O9_.js";import{S as H}from"./index-CTitp5Qg.js";import{T as P}from"./index-DFDl0PJq.js";import"./videos-CoQTeQLu.js";import"./index-CLQrWQaN.js";import"./Table-CSd7eQib.js";import"./List-BGWr2xJE.js";import"./DownOutlined-DRGhK8zp.js";import"./index-BaNQURuW.js";import"./index-BS-7HFpi.js";import"./index-p3GZU5lJ.js";import"./index-DWB43XHw.js";import"./Dropdown-C4ZC00F-.js";import"./PurePanel-DNUOZ5MP.js";import"./move-DCq-oE7y.js";import"./useBreakpoint-CUrvcDr2.js";import"./Pagination-CIrtJa5e.js";import"./index-UsPtaxTh.js";import"./SearchOutlined-BUONfEHJ.js";import"./index-7X6rB-D6.js";import"./index-DD15UiBp.js";const M=r((()=>l((()=>import("./WordStatisticButton-DGDRooso.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url))),W=r((()=>l((()=>import("./ImageLazyPreview-BzCZNgqu.js")),__vite__mapDeps([12,1,2,13,3]),import.meta.url)),{fallback:A}),G=r((()=>l((()=>import("./VideoViewer-HdQ6aks3.js")),__vite__mapDeps([14,1,2,15,3]),import.meta.url)),{fallback:A});function q(e){const t=[];function n(e,i){if(t.push({...e,index:i}),e.reply&&Array.isArray(e.reply.comments)&&e.reply.comments.length)for(let t=0;t<e.reply.comments.length;t++){n(e.reply.comments[t],i+"_"+(t+1))}}for(let i=0;i<e.length;i++)n(e[i],(i+1).toString());return t}function K({target:r=null,postId:l}){var I,A;const{ti:V}=u(),{message:W}=p(),[G,K]=e.useState(!1),[Q,X]=N(`Comment.${l}.total`,0),[Y,Z]=N(`Comment.${l}.loadMoreCount`,10),[U,ee]=N(`Comment.${l}`,[]),[te,ne]=N(`Comment.${l}.intentToken`,o.RECENT_ACTIVITY),[ie,re]=e.useState({}),[le,oe]=N("Comment.maxReplyDepth",1),[se,ae]=e.useState(!1),de=e.useMemo((()=>q(U)),[U]);e.useEffect((()=>{l&&0===U.length&&ce()}),[l,U.length]);const ce=()=>{K(!0),s({postId:l,type:te}).then((e=>{console.log("comment ne",e.comments),ee([...e.comments]),X(e.total)})).finally((()=>{K(!1)}))},me=async()=>{var e;if((null==de?void 0:de.length)||ce(),Y<=0)return;const n="Comment.onLoadMore",i=n+".sleep",r=[...de],o=(null==r?void 0:r.length)+Y;let a=!1,d=0;for(K(!0),W.loading({key:n,duration:0,content:V({en:"Loading comments...",vi:"Đang tải bình luận..."})});(null==r?void 0:r.length)<o&&!a;){const o=null==(e=r[(null==r?void 0:r.length)-1])?void 0:e.cursor,{comments:c,total:m}=await s({postId:l,type:te,cursor:o});if(null==c?void 0:c.length){const e=new Set(r.map((e=>e.id))),l=c.filter((t=>!e.has(t.id)));if(!(null==l?void 0:l.length))break;if(r.push(...l),d+=null==l?void 0:l.length,ee([...r]),m&&X(m),W.loading({key:n,duration:0,content:t.jsxs(t.Fragment,{children:[V({en:"Loading comments...",vi:"Đang tải bình luận..."})+` (${d}/${Y})`,t.jsx("br",{}),V({en:"Click to stop",vi:"Click để dừng"})]}),onClick:()=>a=!0}),d>=Y)break;await $(S(2e3,5e3),(e=>(W.loading({key:i,content:V({en:"Waiting...",vi:"Đang chờ..."})+` (${~~(e/1e3)})`}),a))),W.destroy(i)}else a=!0}K(!1),W.destroy(n),W.success(V({en:`Loaded ${d}/${Y} comments`,vi:`Đã tải ${d}/${Y} bình luận`}))},he=e.useMemo((()=>[...new Set(de.flatMap((e=>{var t;return null==(t=e.signals)?void 0:t.map((e=>e.title))})))].filter(Boolean).map((e=>{var t;return{text:e+" ("+(null==(t=de.filter((t=>{var n;return null==(n=t.signals)?void 0:n.some((t=>t.title===e))})))?void 0:t.length)+")",value:e}}))),[de]),ue=[{title:"#",key:"index",dataIndex:"index"},{title:V({en:"Reply",vi:"Trả lời"}),key:"reply",dataIndex:"reply",render:(e,r,l)=>{var o;const s=r.reply.count||0,a=(null==(o=r.reply.comments)?void 0:o.length)||0;if(0===s)return"";const d=a>=s;return t.jsxs(g,{children:[a?`${a}/${s}`:s,t.jsx(x,{title:V(d?{en:"All replies loaded",vi:"Đã tải hết bình luận"}:{en:"Load replies ",vi:"Tải bình luận trả lời"}),children:t.jsx(n,{icon:t.jsx("i",{className:"fa-solid fa-comments"}),loading:ie[r.id],disabled:d,onClick:()=>(async e=>{re((t=>({...t,[e.id]:!0})));const t=`Comment.onLoadReply.${e.id}`;W.loading({key:t,duration:0,content:V({en:"Loading replies...",vi:"Đang tải trả lời..."})});const n=e.reply.comments[e.reply.comments.length-1],r=null==n?void 0:n.cursor,l=await m({commentId:e.id,expansionToken:e.reply.expansion_token,cursor:r});console.log("replies",l),l.length?(W.success({key:t,content:V({en:"Replies loaded",vi:"Trả lời đã tải"})+` (${l.length})`}),ee((t=>i(t,(t=>{!function t(n){for(const i of n){if(i.id===e.id)return i.reply.comments||(i.reply.comments=[]),i.reply.comments.push(...l),!0;if(i.reply&&Array.isArray(i.reply.comments)&&i.reply.comments.length&&t(i.reply.comments))return!0}return!1}(t)}))))):W.error({key:t,content:V({en:"No replies found",vi:"Không tìm thấy trả lời"})}),re((t=>({...t,[e.id]:!1})))})(r)})})]})},align:"end",rangeFilter:{getValue:e=>e.reply.count},sorter:(e,t)=>t.reply.count-e.reply.count,width:100},{title:V({en:"Author",vi:"Tác giả"}),key:"author",dataIndex:"author",render:(e,n,i)=>{const r=n.depth>0?t.jsx("div",{style:{paddingLeft:20+100*(n.depth-1),paddingRight:5},children:"╰──── "}):null;return t.jsxs(z,{align:"middle",justify:"start",style:{flex:1},children:[r,t.jsx(B,{shape:"square",src:t.jsx(v,{src:y(n.author.id),fallback:n.author.avatar}),size:50}),t.jsxs(g,{direction:"vertical",size:0,style:{marginLeft:10},children:[t.jsx(j.Link,{href:n.author.url||f(n.author.id),target:"_blank",strong:!0,children:n.author.name}),t.jsx(j.Text,{type:"secondary",children:n.author.id})]})]})}},{title:V({en:"Text",vi:"Nội dung"}),key:"text",dataIndex:"text",render:(e,t,n)=>t.text,filters:[{text:V({en:"Has text",vi:"Có nội dung"})+" ("+(null==(I=de.filter((e=>{var t;return(null==(t=e.text)?void 0:t.length)>0})))?void 0:I.length)+")",value:!0},{text:V({en:"No text",vi:"Không nội dung"})+" ("+(null==(A=de.filter((e=>{var t;return 0===(null==(t=e.text)?void 0:t.length)})))?void 0:A.length)+")",value:!1}],onFilter:(e,t)=>{var n,i;return e?(null==(n=t.text)?void 0:n.length)>0:0===(null==(i=t.text)?void 0:i.length)},width:300},{title:V({en:"Attachments",vi:"Đính kèm"}),key:"attachments",dataIndex:"attachments",render:(e,n,i)=>n.attachments.map((e=>t.jsx(J,{attachment:e}))),filters:Object.entries(a).map((([e,t])=>{var n;return{text:e+" ("+(null==(n=de.filter((e=>e.attachments.some((e=>e.type===t)))))?void 0:n.length)+")",value:t}})),onFilter:(e,t)=>t.attachments.some((t=>t.type===e)),width:200},{title:V({en:"Time",vi:"Thời gian"}),key:"created_time",dataIndex:"created_time",render:(e,n,i)=>t.jsxs(g,{direction:"vertical",size:0,children:[t.jsx(j.Text,{children:b(n.created_time)}),t.jsx(j.Text,{type:"secondary",children:k(n.created_time)})]}),sorter:(e,t)=>e.created_time-t.created_time,width:150},{title:V({en:"React",vi:"Thích"}),key:"react",dataIndex:"react",render:(e,n,i)=>t.jsxs(g,{size:3,direction:"vertical",children:[t.jsx(w,{color:n.react.total>0?"success":"default",children:T(n.react.total)}),n.react.each.map((e=>t.jsxs(g,{size:2,children:[t.jsx(v,{preview:!1,src:D[e.id].icon,width:20,height:20})," ",T(e.count)]})))]}),rangeFilter:{getValue:e=>e.react.total},sorter:(e,t)=>t.react.total-e.react.total,width:100},{title:V({en:"Badges",vi:"Huy hiệu"}),key:"badges",dataIndex:"badges",render:(e,n,i)=>{var r,l;return(null==(r=n.badges)?void 0:r.length)?t.jsx(g,{direction:"vertical",children:null==(l=n.badges)?void 0:l.map((e=>t.jsx(x,{title:V(c[e.type]),children:t.jsx(v,{src:e.icon,preview:!1,width:20,height:20})},e.type)))}):"-"},filters:Object.entries(d).map((([e,t])=>{var n;return{text:V(c[t])+" ("+(null==(n=de.filter((e=>{var n;return null==(n=e.badges)?void 0:n.some((e=>e.type===t))})))?void 0:n.length)+")",value:t}})),onFilter:(e,t)=>{var n;return null==(n=t.badges)?void 0:n.some((t=>t.type===e))},width:100},(null==r?void 0:r.type)===C.Group?{title:V({en:"Signals",vi:"Tín hiệu"}),key:"signals",dataIndex:"signals",render:(e,n,i)=>{var r;return t.jsx(g,{direction:"vertical",children:null==(r=n.signals)?void 0:r.map((e=>t.jsxs(w,{children:[e.icon&&t.jsx(v,{src:e.icon,preview:!1,width:20,height:20}),e.title]},e.id)))})},filters:he,onFilter:(e,t)=>{var n;return null==(n=t.signals)?void 0:n.some((t=>t.title===e))},width:100}:{},{title:V({en:"Gender",vi:"Giới tính"}),key:"gender",dataIndex:"gender",render:(e,n,i)=>{const r=E[n.author.gender];return r?t.jsx(w,{color:r.color,children:V(r)}):null},filters:Object.entries(E).map((([e,t])=>{var n;return{text:V(t)+" ("+(null==(n=de.filter((t=>t.author.gender===e)))?void 0:n.length)+")",value:e}})),onFilter:(e,t)=>t.author.gender===e,width:100},{title:V({en:"Actions",vi:"Hành động"}),key:"actions",dataIndex:"actions",render:(e,i,r)=>t.jsx(g,{children:t.jsx(x,{title:V({en:"View comment",vi:"Xem bình luận"}),children:t.jsx(n,{href:i.url,target:"_blank",icon:t.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})})})}),width:100}],pe=async(e,n,i,r)=>{var l,o,s,a,d;if(n>=i||!(null==(l=e.reply)?void 0:l.count)||(null==(o=e.reply.comments)?void 0:o.length)>=e.reply.count)return e;let c={...e},h=(null==(s=c.reply.comments)?void 0:s.length)||0,u=h>0?null==(a=c.reply.comments[h-1])?void 0:a.cursor:void 0,p=c.reply.comments?[...c.reply.comments]:[],x=c.reply.expansion_token;for(;p.length<c.reply.count;){const i=await m({commentId:c.id,expansionToken:x,cursor:u});if(!i.length)break;p.push(...i),u=null==(d=i[i.length-1])?void 0:d.cursor;const l="fetchAllReplies.waiting."+n+"."+e.id;if(await $(S(500,2e3),(e=>(W.loading({key:l,content:t.jsxs(g,{direction:"vertical",size:3,children:[t.jsxs(j.Text,{children:[V({en:"Comment",vi:"Bình luận"}),":"," ",F(c.text,50)]}),t.jsxs(j.Text,{children:[V({en:"Depth",vi:"Độ sâu"}),": ",n,"; ",V({en:"Loaded",vi:"Đã tải"}),": ",p.length,"/",c.reply.count,"; ",V({en:"Waiting...",vi:"Đang chờ..."})," ",~~(e/1e3)]})]})}),r()))),r())break}for(let t=0;t<p.length&&(p[t]=await pe(p[t],n+1,i,r),!r());t++);return c.reply.comments=p,c};return t.jsxs(z,{align:"middle",justify:"center",children:[t.jsx(R,{type:"info",showIcon:!0,message:V({en:"Total comments (include replies): ",vi:"Tổng bình luận (bao gồm trả lời): "})+T(Q),style:{marginBottom:10}}),t.jsx(L,{columns:ue,data:de,searchable:!0,selectable:!0,keyExtractor:e=>e.id+" "+e.parent_id+e.created_time,renderTitle:e=>{const i=(null==e?void 0:e.length)>0?e:de,r=i.filter((e=>e.reply.count>0&&e.reply.comments.length<e.reply.count));return t.jsxs(g,{wrap:!0,children:[t.jsxs(g.Compact,{children:[t.jsx(O,{data:(null==e?void 0:e.length)>0?e:de,options:[{key:"json (raw)",label:".json (raw)",prepareData:e=>({data:JSON.stringify(e,null,2),fileName:`${l}-comments-raw-${l}.json`})},{key:"json (flat array)",label:".json (flat array)",prepareData:e=>({data:JSON.stringify(q(e),null,2),fileName:`${l}-comments-flat-${l}.json`})}]}),t.jsx(H,{value:te,onChange:ne,options:Object.entries(h).map((([e,t])=>({value:e}))),labelRender:e=>t.jsxs(g,{size:5,children:[t.jsx("i",{className:h[e.value].icon}),V(h[e.value])]}),placeholder:V({en:"Select display mode",vi:"Chọn mode hiển thị"}),popupMatchSelectWidth:!1,optionRender:e=>{const n=h[e.value],i=V(n),r=V(n.description);return t.jsxs("div",{style:{width:300,padding:5},children:[t.jsxs(g,{children:[t.jsx("i",{className:n.icon}),t.jsx(j.Text,{strong:!0,children:i})]}),t.jsx(j.Text,{type:"secondary",style:{fontSize:"12px",width:"100%",display:"block",whiteSpace:"normal",wordBreak:"break-word",marginTop:5},children:r})]})}}),t.jsx(n,{icon:t.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:ce,loading:G,children:V({en:"Refresh",vi:"Làm mới"})})]}),t.jsxs(g.Compact,{children:[t.jsx(x,{title:V({en:"Number of comments to load more",vi:"Số lượng bình luận muốn tải thêm"})+"\nmin: 1, max: "+(Q-(null==de?void 0:de.length)-de.map((e=>e.reply.count)).reduce(((e,t)=>e+t),0)),children:t.jsx(P,{min:1,max:Q-(null==de?void 0:de.length),value:Y,onChange:e=>{Z(e)}})}),t.jsx(n,{icon:t.jsx("i",{className:"fa-solid fa-play"}),onClick:me,disabled:Y<=0,loading:G,children:V({en:"Load more",vi:"Tải thêm"})})]}),t.jsxs(g.Compact,{children:[t.jsx(x,{title:V({en:"Max reply depth",vi:"Độ sâu trả lời tối đa"}),children:t.jsx(P,{min:1,max:10,value:le,onChange:e=>oe(e||1)})}),t.jsx(x,{title:V({en:"Fetch replies of selected comments",vi:"Tải trả lời của bình luận đang chọn"}),children:t.jsx(n,{icon:t.jsx("i",{className:"fa-solid fa-comments"}),loading:se,onClick:()=>(async e=>{ae(!0);try{let n=function(e,t){var i;for(let r=0;r<e.length;r++){if(e[r].id===t.id)return e[r]=t,!0;if(e[r].reply&&(null==(i=e[r].reply.comments)?void 0:i.length)&&n(e[r].reply.comments,t))return!0}return!1},i=[...U],r=0,l=!1,o="fetchAllReplies.stopping";for(let s=0;s<e.length;s++){const a=e[s];W.loading({key:"fetchAllReplies",duration:0,content:t.jsxs(t.Fragment,{children:[V({en:`Fetching replies (${s+1}/${e.length})...`,vi:`Đang tải trả lời (${s+1}/${e.length})...`}),t.jsx("br",{}),V({en:"Click to stop",vi:"Nhấn để dừng"})]}),onClick:()=>{l=!0,W.loading({key:o,duration:0,content:V({en:"Stopping...",vi:"Đang dừng..."})})}});const d=await pe(a,a.depth||0,le,(()=>l));if(n(i,d),r++,ee([...i]),l)break}W.destroy(o),W.success({key:"fetchAllReplies",content:V({en:`Fetched all replies for ${r} comments`,vi:`Đã tải trả lời cho ${r} bình luận`})})}catch(n){W.error({key:"fetchAllReplies",content:V({en:"Error fetching replies",vi:"Lỗi khi tải trả lời"})})}finally{ae(!1)}})(r),disabled:se||0===r.length,children:r.length})})]}),t.jsx(M,{text:i.map((e=>e.text)).join(" ")})]})},onSearchRow:(e,t)=>{var n,i;return[null==(n=t.author)?void 0:n.id,null==(i=t.author)?void 0:i.name,t.text,t.id].some((t=>_(e,t)))}})]})}function J({attachment:e}){switch(e.type){case a.PHOTO:return t.jsx(I.Ribbon,{text:"Photo",children:t.jsx(W,{src:e.image,style:{objectFit:"cover",borderRadius:10,maxWidth:200,maxHeight:200},cacheId:"photos."+e.id,getPreview:()=>V(e.id).then((e=>e.image))})});case a.VIDEO:return t.jsx(I.Ribbon,{text:"Video",children:t.jsx(v,{src:e.image,style:{objectFit:"cover",borderRadius:10,maxWidth:200,maxHeight:200},preview:{destroyOnClose:!0,imageRender:()=>t.jsx(G,{info:e.video,style:{maxWidth:"90vw",maxHeight:"90vh"}}),toolbarRender:()=>null}})});case a.STICKER:return t.jsx(I.Ribbon,{text:"Sticker",children:t.jsx(v,{src:e.image,style:{objectFit:"cover",borderRadius:10,maxWidth:200,maxHeight:200}})});case a.GIF:return t.jsx(I.Ribbon,{text:"GIF",children:t.jsx(v,{src:e.image,style:{objectFit:"cover",borderRadius:10,maxWidth:200,maxHeight:200}})})}return null}export{K as default};
