import{r as t}from"./AVTiV6ai.js";var n,r;function e(){if(r)return n;r=1;const e=t.dispatch,a=Math.PI/180,o={archimedean:g,rectangular:function(t){var n=4*t[0]/t[1],r=0,e=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:r+=n;break;case 1:e+=4;break;case 2:r-=n;break;default:e-=4}return[r,e]}}},i=2048;function u(t){return t.text}function f(){return"serif"}function l(){return"normal"}function c(t){return Math.sqrt(t.value)}function s(){return 30*(~~(6*random())-3)}function h(){return 1}function y(t,n,r,e){if(!n.sprite){var o=t.context,u=t.ratio;o.clearRect(0,0,2048/u,i/u);var f=0,l=0,c=0,s=r.length;for(--e;++e<s;){n=r[e],o.save(),o.font=n.style+" "+n.weight+" "+~~((n.size+1)/u)+"px "+n.font;const t=o.measureText(n.text),s=-Math.floor(t.width/2);let p=(t.width+1)*u,M=n.size<<1;if(n.rotate){var h=Math.sin(n.rotate*a),y=Math.cos(n.rotate*a),x=p*y,d=p*h,g=M*y,v=M*h;p=Math.max(Math.abs(x+v),Math.abs(x-v))+31>>5<<5,M=~~Math.max(Math.abs(d+g),Math.abs(d-g))}else p=p+31>>5<<5;if(M>c&&(c=M),f+p>=2048&&(f=0,l+=c,c=0),l+M>=i)break;o.translate((f+(p>>1))/u,(l+(M>>1))/u),n.rotate&&o.rotate(n.rotate*a),o.fillText(n.text,s,0),n.padding&&(o.lineWidth=2*n.padding,o.strokeText(n.text,s,0)),o.restore(),n.width=p,n.height=M,n.xoff=f,n.yoff=l,n.x1=p>>1,n.y1=M>>1,n.x0=-n.x1,n.y0=-n.y1,n.hasText=!0,f+=p}for(var p=o.getImageData(0,0,2048/u,i/u).data,M=[];--e>=0;)if((n=r[e]).hasText){for(var m=n.width,w=m>>5,b=n.y1-n.y0,z=0;z<b*w;z++)M[z]=0;if(null==(f=n.xoff))return;l=n.yoff;for(var I=0,k=-1,T=0;T<b;T++){for(z=0;z<m;z++){var q=w*T+(z>>5),D=p[2048*(l+T)+(f+z)<<2]?1<<31-z%32:0;M[q]|=D,I|=D}I?k=T:(n.y0++,b--,T--,l++)}n.y1=n.y0+k,n.sprite=M.slice(0,(n.y1-n.y0)*w)}}}function x(t,n,r){r>>=5;for(var e,a=t.sprite,o=t.width>>5,i=t.x-(o<<4),u=127&i,f=32-u,l=t.y1-t.y0,c=(t.y+t.y0)*r+(i>>5),s=0;s<l;s++){e=0;for(var h=0;h<=o;h++)if((e<<f|(h<o?(e=a[s*o+h])>>>u:0))&n[c+h])return!0;c+=r}return!1}function d(t,n){var r=t[0],e=t[1];n.x+n.x0<r.x&&(r.x=n.x+n.x0),n.y+n.y0<r.y&&(r.y=n.y+n.y0),n.x+n.x1>e.x&&(e.x=n.x+n.x1),n.y+n.y1>e.y&&(e.y=n.y+n.y1)}function g(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function v(){return document.createElement("canvas")}function p(t){return"function"==typeof t?t:function(){return t}}return n=function(){var t=[256,256],n=u,r=f,a=c,M=l,m=l,w=s,b=h,z=g,I=[],k=1/0,T=e("word","end"),q=null,D=Math.random,S={},R=v;function W(n,r,e){t[0],t[1];for(var a,o,i,u,f,l=r.x,c=r.y,s=Math.sqrt(t[0]*t[0]+t[1]*t[1]),h=z(t),y=D()<.5?1:-1,d=-y;(a=h(d+=y))&&(o=~~a[0],i=~~a[1],!(Math.min(Math.abs(o),Math.abs(i))>=s));)if(r.x=l+o,r.y=c+i,!(r.x+r.x0<0||r.y+r.y0<0||r.x+r.x1>t[0]||r.y+r.y1>t[1]||e&&(f=e,!((u=r).x+u.x1>f[0].x&&u.x+u.x0<f[1].x&&u.y+u.y1>f[0].y&&u.y+u.y0<f[1].y))||x(r,n,t[0]))){for(var g,v=r.sprite,p=r.width>>5,M=t[0]>>5,m=r.x-(p<<4),w=127&m,b=32-w,I=r.y1-r.y0,k=(r.y+r.y0)*M+(m>>5),T=0;T<I;T++){g=0;for(var q=0;q<=p;q++)n[k+q]|=g<<b|(q<p?(g=v[T*p+q])>>>w:0);k+=M}return!0}return!1}return S.canvas=function(t){return arguments.length?(R=p(t),S):R},S.start=function(){var e=function(t){const n=t.getContext("2d",{willReadFrequently:!0});t.width=t.height=1;const r=Math.sqrt(n.getImageData(0,0,1,1).data.length>>2);return t.width=2048/r,t.height=i/r,n.fillStyle=n.strokeStyle="red",{context:n,ratio:r}}(R()),o=function(t){var n=[],r=-1;for(;++r<t;)n[r]=0;return n}((t[0]>>5)*t[1]),u=null,f=I.length,l=-1,c=[],s=I.map((function(t,e){return t.text=n.call(this,t,e),t.font=r.call(this,t,e),t.style=M.call(this,t,e),t.weight=m.call(this,t,e),t.rotate=w.call(this,t,e),t.size=~~a.call(this,t,e),t.padding=b.call(this,t,e),t})).sort((function(t,n){return n.size-t.size}));return q&&clearInterval(q),q=setInterval(h,0),h(),S;function h(){for(var n=Date.now();Date.now()-n<k&&++l<f&&q;){var r=s[l];r.x=t[0]*(D()+.5)>>1,r.y=t[1]*(D()+.5)>>1,y(e,r,s,l),r.hasText&&W(o,r,u)&&(c.push(r),T.call("word",S,r),u?d(u,r):u=[{x:r.x+r.x0,y:r.y+r.y0},{x:r.x+r.x1,y:r.y+r.y1}],r.x-=t[0]>>1,r.y-=t[1]>>1)}l>=f&&(S.stop(),T.call("end",S,c,u))}},S.stop=function(){q&&(clearInterval(q),q=null);for(const t of I)delete t.sprite;return S},S.timeInterval=function(t){return arguments.length?(k=null==t?1/0:t,S):k},S.words=function(t){return arguments.length?(I=t,S):I},S.size=function(n){return arguments.length?(t=[+n[0],+n[1]],S):t},S.font=function(t){return arguments.length?(r=p(t),S):r},S.fontStyle=function(t){return arguments.length?(M=p(t),S):M},S.fontWeight=function(t){return arguments.length?(m=p(t),S):m},S.rotate=function(t){return arguments.length?(w=p(t),S):w},S.text=function(t){return arguments.length?(n=p(t),S):n},S.spiral=function(t){return arguments.length?(z=o[t]||t,S):z},S.fontSize=function(t){return arguments.length?(a=p(t),S):a},S.padding=function(t){return arguments.length?(b=p(t),S):b},S.random=function(t){return arguments.length?(D=t,S):D},S.on=function(){var t=T.on.apply(T,arguments);return t===T?S:t},S},n}export{e as r};
