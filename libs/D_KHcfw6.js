function t(t,n,a,l,s,c={}){const{threshold:h=.1,alpha:u=.1,aaColor:m=[255,255,0],diffColor:d=[255,0,0],includeAA:M,diffColorAlt:w,diffMask:g}=c;if(!e(t)||!e(n)||a&&!e(a))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==n.length||a&&a.length!==t.length)throw new Error("Image sizes do not match.");if(t.length!==l*s*4)throw new Error("Image data size does not match width/height.");const A=l*s,E=new Uint32Array(t.buffer,t.byteOffset,A),y=new Uint32Array(n.buffer,n.byteOffset,A);let b=!0;for(let e=0;e<A;e++)if(E[e]!==y[e]){b=!1;break}if(b){if(a&&!g)for(let e=0;e<A;e++)i(t,4*e,u,a);return 0}const x=35215*h*h,[p,C,U]=m,[B,I,k]=d,[z,O,T]=w||d;let _=0;for(let e=0;e<s;e++)for(let c=0;c<l;c++){const h=e*l+c,m=4*h,d=E[h]===y[h]?0:o(t,n,m,m,!1);if(Math.abs(d)>x){const o=r(t,c,e,l,s,E,y)||r(n,c,e,l,s,y,E);!M&&o?a&&!g&&f(a,m,p,C,U):(a&&(d<0?f(a,m,z,O,T):f(a,m,B,I,k)),_++)}else a&&!g&&i(t,m,u,a)}return _}function e(t){return ArrayBuffer.isView(t)&&1===t.BYTES_PER_ELEMENT}function r(t,e,r,f,i,a,l){const s=Math.max(e-1,0),c=Math.max(r-1,0),h=Math.min(e+1,f-1),u=Math.min(r+1,i-1),m=r*f+e;let d=e===s||e===h||r===c||r===u?1:0,M=0,w=0,g=0,A=0,E=0,y=0;for(let n=s;n<=h;n++)for(let i=c;i<=u;i++){if(n===e&&i===r)continue;const a=o(t,t,4*m,4*(i*f+n),!0);if(0===a){if(d++,d>2)return!1}else a<M?(M=a,g=n,A=i):a>w&&(w=a,E=n,y=i)}return 0!==M&&0!==w&&(n(a,g,A,f,i)&&n(l,g,A,f,i)||n(a,E,y,f,i)&&n(l,E,y,f,i))}function n(t,e,r,n,o){const f=Math.max(e-1,0),i=Math.max(r-1,0),a=Math.min(e+1,n-1),l=Math.min(r+1,o-1),s=t[r*n+e];let c=e===f||e===a||r===i||r===l?1:0;for(let h=f;h<=a;h++)for(let o=i;o<=l;o++)if((h!==e||o!==r)&&(c+=+(s===t[o*n+h]),c>2))return!0;return!1}function o(t,e,r,n,o){const f=t[r],i=t[r+1],a=t[r+2],l=t[r+3],s=e[n],c=e[n+1],h=e[n+2],u=e[n+3];let m=f-s,d=i-c,M=a-h;const w=l-u;if(!(m||d||M||w))return 0;if(l<255||u<255){m=(f*l-s*u-(48+r%2*159)*w)/255,d=(i*l-c*u-(48+(r/1.618033988749895|0)%2*159)*w)/255,M=(a*l-h*u-(48+(r/2.618033988749895|0)%2*159)*w)/255}const g=.29889531*m+.58662247*d+.11448223*M;if(o)return g;const A=.59597799*m-.2741761*d-.32180189*M,E=.21147017*m-.52261711*d+.31114694*M,y=.5053*g*g+.299*A*A+.1957*E*E;return g>0?-y:y}function f(t,e,r,n,o){t[e+0]=r,t[e+1]=n,t[e+2]=o,t[e+3]=255}function i(t,e,r,n){const o=255+(.29889531*t[e]+.58662247*t[e+1]+.11448223*t[e+2]-255)*r*t[e+3]/255;f(n,e,o,o,o)}export{t as p};
